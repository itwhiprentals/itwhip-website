generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Account {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model AccountHold {
  id              String          @id
  guestId         String
  reason          String
  amount          Decimal         @db.Decimal(10, 2)
  claimId         String?
  active          Boolean         @default(true)
  startedAt       DateTime        @default(now())
  endedAt         DateTime?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  ReviewerProfile ReviewerProfile @relation(fields: [guestId], references: [id], onDelete: Cascade)

  @@index([active])
  @@index([claimId])
  @@index([guestId])
}

model AccountLinkRequest {
  id               String      @id
  initiatingUserId String
  targetEmail      String
  verificationCode String
  codeExpiresAt    DateTime
  status           MergeStatus @default(PENDING)
  legacyDualId     String?
  requestedAt      DateTime    @default(now())
  verifiedAt       DateTime?
  guestLinkToken   String?     @unique
  hostLinkToken    String?     @unique
  guestConfirmedAt DateTime?

  @@index([guestLinkToken])
  @@index([hostLinkToken])
  @@index([initiatingUserId])
  @@index([status])
  @@index([targetEmail])
}

model ActivityLog {
  id         String   @id
  userId     String?
  action     String
  entityType String
  entityId   String
  metadata   Json?
  ipAddress  String?
  createdAt  DateTime @default(now())
  adminId    String?
  category   String?
  guestId    String?
  hostId     String?
  newValue   String?
  oldValue   String?
  severity   String?  @default("INFO")
  userAgent  String?
  user       User?    @relation(fields: [userId], references: [id])

  @@index([adminId])
  @@index([category])
  @@index([createdAt])
  @@index([entityType])
  @@index([hostId])
  @@index([severity])
  @@index([userId])
}

model AdminNotification {
  id             String    @id
  type           String
  title          String
  message        String
  priority       String    @default("MEDIUM")
  status         String    @default("UNREAD")
  relatedId      String?
  relatedType    String?
  actionRequired Boolean   @default(false)
  actionUrl      String?
  resolvedBy     String?
  resolvedAt     DateTime?
  resolution     String?
  metadata       Json?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime

  @@index([createdAt])
  @@index([priority])
  @@index([status])
  @@index([type])
}

model AmadeusCarCache {
  id         String   @id
  location   String
  searchDate DateTime
  carData    String
  expiresAt  DateTime

  @@index([expiresAt])
  @@index([location, searchDate])
}

model ApiKey {
  id          String             @id
  key         String             @unique
  name        String
  userId      String
  hotelId     String?
  permissions String
  tier        CertificationTier?
  rateLimit   Int                @default(1000)
  rateWindow  String             @default("hour")
  lastUsed    DateTime?
  usageCount  Int                @default(0)
  active      Boolean            @default(true)
  expiresAt   DateTime?
  createdAt   DateTime           @default(now())
  Hotel       Hotel?             @relation(fields: [hotelId], references: [id])
  user        User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([hotelId])
  @@index([key])
}

model AppealNotification {
  id          String          @id
  guestId     String
  appealId    String
  type        String
  message     String?
  seen        Boolean         @default(false)
  dismissedAt DateTime?
  createdAt   DateTime        @default(now())
  appeal      GuestAppeal     @relation(fields: [appealId], references: [id], onDelete: Cascade)
  guest       ReviewerProfile @relation(fields: [guestId], references: [id], onDelete: Cascade)

  @@index([appealId])
  @@index([guestId, seen])
}

model ApplicationActivity {
  id            String   @id
  applicationId String
  action        String
  performedBy   String
  details       Json?
  createdAt     DateTime @default(now())

  @@index([applicationId])
  @@index([createdAt])
}

model AuditLog {
  id           String        @id
  category     AuditCategory
  eventType    String
  severity     AuditSeverity
  userId       String?
  adminId      String?
  adminEmail   String?
  hotelId      String?
  ipAddress    String
  userAgent    String
  sessionId    String?
  requestId    String?
  action       String
  resource     String
  resourceId   String?
  amount       Decimal?      @db.Decimal(10, 2)
  currency     String?       @default("USD")
  stripeId     String?
  details      Json?
  changes      Json?
  metadata     Json?
  gdpr         Boolean       @default(false)
  ccpa         Boolean       @default(false)
  pci          Boolean       @default(false)
  sox          Boolean       @default(false)
  hash         String
  previousHash String?
  verified     Boolean       @default(false)
  backedUp     Boolean       @default(false)
  archivedAt   DateTime?
  timestamp    DateTime      @default(now())
  user         User?         @relation(fields: [userId], references: [id])

  @@index([adminEmail])
  @@index([adminId])
  @@index([category])
  @@index([eventType])
  @@index([hotelId])
  @@index([resourceId])
  @@index([severity])
  @@index([timestamp])
  @@index([userId])
}

// ============================================
// ANALYTICS - Page View Tracking
// Immutable event log for site analytics
// Inspired by Stripe's Ledger pattern
// ============================================
model PageView {
  id String @id @default(cuid())

  // What was viewed
  path        String // /fleet/hosts, /rentals/abc123
  referrer    String? // https://google.com
  queryParams String? // Sanitized query params (no sensitive data)

  // Who viewed it
  userId    String? // Logged-in user ID (optional)
  sessionId String? // Anonymous session tracking
  visitorId String? // Fingerprint for unique visitors

  // Device info (parsed from user agent)
  userAgent  String // Full user agent string
  device     String? // desktop, mobile, tablet
  browser    String? // Chrome, Safari, Firefox
  browserVer String? // Browser version
  os         String? // Windows, macOS, iOS, Android

  // Location (from Vercel/Cloudflare headers)
  country String? // US, UK, MX (ISO 3166-1 alpha-2)
  region  String? // Arizona, California, Texas
  city    String? // Phoenix, Los Angeles

  // Performance metrics
  loadTime Int? // Page load time in ms

  // Event metadata
  eventType String @default("pageview") // pageview, click, scroll, etc.
  metadata  Json? // Additional event-specific data

  // Timing (immutable - never update, only insert)
  timestamp DateTime @default(now())

  // Composite indexes for fast analytics queries
  @@index([path])
  @@index([timestamp])
  @@index([userId])
  @@index([country])
  @@index([visitorId])
  @@index([eventType])
  @@index([path, timestamp]) // Top pages over time
  @@index([country, timestamp]) // Geographic trends
  @@index([device, timestamp]) // Device trends
  @@index([visitorId, timestamp]) // Returning users analysis
  @@index([sessionId, visitorId]) // Bounce rate (single-page sessions)
  @@index([visitorId, eventType, timestamp]) // Visitor activity tracking
}

model BackgroundCheck {
  id               String                @id
  hostId           String
  checkType        String
  status           BackgroundCheckStatus @default(PENDING)
  provider         String?
  requestedAt      DateTime              @default(now())
  completedAt      DateTime?
  expiresAt        DateTime?
  passed           Boolean?
  score            Int?
  details          Json?
  reportUrl        String?
  failureReason    String?
  issues           Json?
  manuallyReviewed Boolean               @default(false)
  reviewedBy       String?
  reviewedAt       DateTime?
  overrideReason   String?
  retryCount       Int                   @default(0)
  nextRetryAt      DateTime?
  createdAt        DateTime              @default(now())
  updatedAt        DateTime
  host             RentalHost            @relation(fields: [hostId], references: [id])

  @@unique([hostId, checkType])
  @@index([checkType])
  @@index([expiresAt])
  @@index([hostId])
  @@index([status])
}

model Booking {
  id                 String        @id
  confirmationNumber String        @unique
  hotelId            String
  guestId            String
  checkIn            DateTime
  checkOut           DateTime
  nights             Int
  roomType           String
  roomNumber         String?
  roomRate           Float
  source             BookingSource
  status             BookingStatus
  roomCharges        Float
  taxes              Float
  fees               Float
  totalAmount        Float
  currency           String        @default("USD")
  airportPickup      Boolean       @default(false)
  airportDropoff     Boolean       @default(false)
  ridesIncluded      Int           @default(0)
  ridesUsed          Int           @default(0)
  canModify          Boolean       @default(true)
  canCancel          Boolean       @default(true)
  notes              String?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime
  Guest              Guest         @relation(fields: [guestId], references: [id])
  Hotel              Hotel         @relation(fields: [hotelId], references: [id])
  Ride               Ride[]

  @@index([confirmationNumber])
  @@index([guestId])
  @@index([hotelId])
  @@index([status])
}

model BookingSession {
  id               String         @id
  bookingId        String?        @unique
  sessionId        String         @unique
  startedAt        DateTime       @default(now())
  completedAt      DateTime?
  duration         Int?
  abandoned        Boolean        @default(false)
  pageViews        String?
  lastPage         String?
  clickCount       Int            @default(0)
  scrollDepth      Float?
  timeOnPage       String?
  fieldTimings     String?
  fieldFocusCount  String?
  validationErrors Int            @default(0)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime
  booking          RentalBooking? @relation(fields: [bookingId], references: [id])

  @@index([abandoned])
  @@index([sessionId])
}

model ChargeAdjustment {
  id                String        @id
  bookingId         String
  chargeId          String?
  adjustmentType    String
  reason            String
  originalAmount    Decimal       @db.Decimal(10, 2)
  adjustedAmount    Decimal       @db.Decimal(10, 2)
  reductionAmount   Decimal       @db.Decimal(10, 2)
  reductionPercent  Int?
  adjustmentDetails String?
  adminId           String
  adminEmail        String
  adminNotes        String?
  processedAt       DateTime?
  stripeChargeId    String?
  stripeRefundId    String?
  processingStatus  String        @default("pending")
  failureReason     String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime
  booking           RentalBooking @relation(fields: [bookingId], references: [id])
  TripCharge        TripCharge?   @relation(fields: [chargeId], references: [id])

  @@index([adminId])
  @@index([bookingId])
  @@index([chargeId])
  @@index([processingStatus])
}

model Claim {
  id                      String             @id
  policyId                String
  bookingId               String
  hostId                  String
  type                    ClaimType
  reportedBy              String
  description             String
  incidentDate            DateTime
  estimatedCost           Float
  status                  ClaimStatus
  reviewedBy              String?
  reviewedAt              DateTime?
  reviewNotes             String?
  approvedAmount          Float?
  deductible              Float              @default(500)
  payoutId                String?
  paidToHost              DateTime?
  paidAmount              Float?
  platformAdvanceAmount   Float?
  recoveredFromGuest      Float?
  recoveryStatus          RecoveryStatus?
  overrideHistory         Json?
  guestAtFault            Boolean            @default(false)
  faultPercentage         Int?
  createdAt               DateTime           @default(now())
  updatedAt               DateTime
  resolvedAt              DateTime?
  accountHoldApplied      Boolean            @default(false)
  activityLog             Json?
  escalationSentAt        DateTime?
  guestNotifiedAt         DateTime?
  guestResponseDate       DateTime?
  guestResponseDeadline   DateTime?
  guestResponsePhotos     Json?
  guestResponseText       String?
  hostNotifiedAt          DateTime?
  lastMessageAt           DateTime?
  reactivationNotes       String?
  reminderSentAt          DateTime?
  repairDocumentUrls      Json?
  safetyChecklistData     Json?
  statusHistory           Json?
  unreadMessagesCount     Int                @default(0)
  vehicleDeactivated      Boolean            @default(false)
  vehicleReactivatedAt    DateTime?
  vehicleReactivatedBy    String?
  guestRespondedAt        DateTime?
  insurerClaimId          String?
  insurerDenialReason     String?
  insurerPaidAmount       Float?
  insurerPaidAt           DateTime?
  insurerStatus           String?
  lockedCarState          String?
  primaryParty            String?
  severity                String?
  submittedToInsurerAt    DateTime?
  damagePhotosLegacy      Json?
  incidentAddress         String?
  incidentCity            String?
  incidentLatitude        Float?
  incidentLongitude       Float?
  incidentState           String?
  incidentZip             String?
  policeReportNumber      String?
  roadConditions          String?
  weatherConditions       String?
  witnesses               Json?
  estimatedSpeed          Int?
  incidentDescription     String?
  injuries                Json?
  odometerAtIncident      Int?
  officerBadge            String?
  officerName             String?
  otherParty              Json?
  otherPartyInvolved      Boolean            @default(false)
  policeDepartment        String?
  policeReportDate        DateTime?
  policeReportFiled       Boolean            @default(false)
  roadDescription         String?
  trafficConditions       String?
  vehicleDrivable         Boolean            @default(true)
  vehicleLocation         String?
  wasPoliceContacted      Boolean            @default(false)
  weatherDescription      String?
  wereInjuries            Boolean            @default(false)
  adjusterAssigned        Boolean            @default(false)
  adjusterAssignedAt      DateTime?
  adjusterEmail           String?
  adjusterName            String?
  adjusterPhone           String?
  claimClosedAt           DateTime?
  claimOpenedAt           DateTime?
  claimSubmittedToInsurer DateTime?
  fnolNumber              String?            @unique
  fnolStatus              String?            @default("NOT_STARTED")
  fnolSubmittedAt         DateTime?
  fnolSubmittedBy         String?
  filedByGuestId          String?
  filedByRole             String?
  booking                 RentalBooking      @relation(fields: [bookingId], references: [id])
  host                    RentalHost         @relation(fields: [hostId], references: [id])
  InsurancePolicy         InsurancePolicy    @relation(fields: [policyId], references: [id])
  ClaimDamagePhoto        ClaimDamagePhoto[]
  ClaimEdit               ClaimEdit[]
  ClaimMessage            ClaimMessage[]
  TripIssue               TripIssue?

  @@unique([bookingId, hostId])
  @@index([bookingId])
  @@index([filedByGuestId])
  @@index([filedByRole])
  @@index([fnolNumber])
  @@index([fnolStatus])
  @@index([guestResponseDeadline])
  @@index([hostId])
  @@index([incidentCity])
  @@index([incidentState])
  @@index([lastMessageAt])
  @@index([otherPartyInvolved])
  @@index([payoutId])
  @@index([policeReportNumber])
  @@index([policyId])
  @@index([status])
  @@index([type])
  @@index([vehicleDeactivated])
  @@index([vehicleDrivable])
  @@index([wasPoliceContacted])
  @@index([wereInjuries])
}

model ClaimDamagePhoto {
  id         String    @id
  claimId    String
  url        String
  caption    String?
  order      Int       @default(0)
  uploadedBy String
  uploadedAt DateTime  @default(now())
  deletedAt  DateTime?
  deletedBy  String?
  createdAt  DateTime  @default(now())
  claim      Claim     @relation(fields: [claimId], references: [id], onDelete: Cascade)

  @@index([claimId])
  @@index([deletedAt])
  @@index([uploadedAt])
  @@index([uploadedBy])
}

model ClaimEdit {
  id           String   @id
  claimId      String
  fieldChanged String
  oldValue     String?
  newValue     String?
  editedAt     DateTime @default(now())
  editedBy     String
  editedByType String
  reason       String?
  createdAt    DateTime @default(now())
  claim        Claim    @relation(fields: [claimId], references: [id], onDelete: Cascade)

  @@index([claimId])
  @@index([editedAt])
  @@index([editedBy])
  @@index([fieldChanged])
}

model ClaimMessage {
  id          String   @id
  claimId     String
  senderId    String
  senderType  String
  senderName  String?
  message     String
  attachments Json?
  readBy      Json?
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  claim       Claim    @relation(fields: [claimId], references: [id], onDelete: Cascade)

  @@index([claimId])
  @@index([createdAt])
  @@index([senderType])
}

model ContactMessage {
  id         String        @id
  name       String
  email      String
  phone      String?
  subject    String
  message    String
  status     MessageStatus @default(UNREAD)
  repliedAt  DateTime?
  repliedBy  String?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime
  replies    Json?         @default("[]")
  replyCount Int           @default(0)

  @@index([email])
  @@index([status])
}

model CreditBonusTransaction {
  id              String          @id
  guestId         String
  type            String
  action          String
  amount          Float
  balanceAfter    Float
  bookingId       String?
  reason          String?
  expiresAt       DateTime?
  adjustedBy      String?
  createdAt       DateTime        @default(now())
  ReviewerProfile ReviewerProfile @relation(fields: [guestId], references: [id])

  @@index([action])
  @@index([bookingId])
  @@index([createdAt])
  @@index([expiresAt])
  @@index([guestId])
  @@index([type])
}

model DataExportLog {
  id          String    @id
  userId      String
  requestedAt DateTime  @default(now())
  completedAt DateTime?
  downloadUrl String?
  expiresAt   DateTime?
  status      String    @default("pending")
  fileSize    Int?
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([userId])
}

model DepositTransaction {
  id                    String          @id
  guestId               String
  type                  String
  amount                Float
  balanceAfter          Float
  bookingId             String?
  stripePaymentIntentId String?
  description           String?
  createdAt             DateTime        @default(now())
  ReviewerProfile       ReviewerProfile @relation(fields: [guestId], references: [id])

  @@index([bookingId])
  @@index([createdAt])
  @@index([guestId])
  @@index([type])
}

model Driver {
  id           String    @id
  name         String
  email        String    @unique
  phone        String
  photo        String?
  rating       Float     @default(5.0)
  totalTrips   Int       @default(0)
  vehicleMake  String
  vehicleModel String
  vehicleYear  Int
  vehicleColor String
  vehiclePlate String
  vehicleType  String
  available    Boolean   @default(true)
  verified     Boolean   @default(false)
  active       Boolean   @default(true)
  lastLat      Float?
  lastLng      Float?
  lastUpdate   DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime
  Ride         Ride[]

  @@index([available])
  @@index([email])
}

model ESGBadge {
  id               String   @id
  badgeCode        String   @unique
  badgeName        String
  badgeDescription String
  badgeIcon        String
  badgeCategory    String
  requiredScore    Int?
  requiredTrips    Int?
  requiredStreak   Int?
  requiredMetric   String?
  requiredValue    Float?
  rarity           String   @default("COMMON")
  points           Int      @default(0)
  createdAt        DateTime @default(now())

  @@index([badgeCode])
}

model ESGEvent {
  id               String   @id
  hostId           String
  eventType        String
  eventCategory    String
  scoreBefore      Int?
  scoreAfter       Int?
  scoreChange      Int?
  description      String
  metadata         Json     @default("{}")
  relatedTripId    String?
  relatedClaimId   String?
  relatedBookingId String?
  createdAt        DateTime @default(now())

  @@index([createdAt])
  @@index([eventCategory])
  @@index([eventType])
  @@index([hostId])
}

model ESGSnapshot {
  id                 String         @id
  profileId          String
  compositeScore     Int
  drivingImpactScore Int
  emissionsScore     Int
  maintenanceScore   Int
  safetyScore        Int
  complianceScore    Int
  snapshotDate       DateTime       @default(now())
  snapshotReason     String
  triggerEventId     String?
  HostESGProfile     HostESGProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@index([snapshotDate])
}

model FraudIndicator {
  id         String        @id
  bookingId  String
  indicator  String
  severity   FraudSeverity
  confidence Float
  details    String?
  source     String
  createdAt  DateTime      @default(now())
  booking    RentalBooking @relation(fields: [bookingId], references: [id])

  @@index([bookingId])
  @@index([indicator])
  @@index([severity])
}

model Guest {
  id          String    @id
  firstName   String
  lastName    String
  email       String?
  phone       String?
  country     String?
  preferences String?
  totalStays  Int       @default(0)
  totalSpent  Float     @default(0)
  lastStay    DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  Booking     Booking[]
  Ride        Ride[]

  @@index([email])
}

model GuestAccessToken {
  id        String        @id
  token     String        @unique
  bookingId String
  email     String
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime      @default(now())
  booking   RentalBooking @relation(fields: [bookingId], references: [id])

  @@index([email])
  @@index([token])
}

model GuestAppeal {
  id                 String               @id
  guestId            String
  moderationId       String
  reason             String
  evidence           Json?
  status             AppealStatus         @default(PENDING)
  reviewedBy         String?
  reviewedAt         DateTime?
  reviewNotes        String?
  submittedAt        DateTime             @default(now())
  updatedAt          DateTime
  AppealNotification AppealNotification[]
  guest              ReviewerProfile      @relation(fields: [guestId], references: [id])
  moderation         GuestModeration      @relation(fields: [moderationId], references: [id])

  @@index([guestId])
  @@index([moderationId])
  @@index([status])
}

model GuestInsurance {
  id              String          @id
  guestId         String
  providerName    String
  policyNumber    String
  verified        Boolean         @default(false)
  verifiedAt      DateTime?
  expiresAt       DateTime?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  ReviewerProfile ReviewerProfile @relation(fields: [guestId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([guestId])
  @@index([verified])
}

model GuestModeration {
  id                  String           @id
  guestId             String
  actionType          ModerationType
  suspensionLevel     SuspensionLevel?
  publicReason        String
  internalNotes       String?
  internalNotesOnly   Boolean          @default(false)
  takenBy             String
  takenAt             DateTime         @default(now())
  expiresAt           DateTime?
  relatedBookingId    String?
  relatedClaimId      String?
  restrictionsApplied Json?
  warningCategory     WarningCategory?
  GuestAppeal         GuestAppeal[]
  ReviewerProfile     ReviewerProfile  @relation(fields: [guestId], references: [id])

  @@index([actionType])
  @@index([expiresAt])
  @@index([guestId, takenAt])
  @@index([takenBy])
  @@index([warningCategory])
}

model GuestProfileStatus {
  id                  String          @id
  guestId             String          @unique
  accountStatus       String          @default("ACTIVE")
  activeWarningCount  Int             @default(0)
  activeSuspensions   Int             @default(0)
  activeRestrictions  String[]        @default([])
  statusHistory       Json            @default("[]")
  restrictionHistory  Json            @default("[]")
  notificationHistory Json            @default("[]")
  lastWarningAt       DateTime?
  lastSuspensionAt    DateTime?
  lastNotificationAt  DateTime?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime
  ReviewerProfile     ReviewerProfile @relation(fields: [guestId], references: [id], onDelete: Cascade)

  @@index([accountStatus])
  @@index([activeSuspensions])
  @@index([activeWarningCount])
  @@index([guestId])
  @@index([lastSuspensionAt])
  @@index([lastWarningAt])
}

model HostBadgeEarned {
  id        String   @id
  hostId    String
  badgeCode String
  earnedAt  DateTime @default(now())

  @@unique([hostId, badgeCode])
  @@index([badgeCode])
  @@index([hostId])
}

model HostDocumentStatus {
  id                 String               @id
  hostId             String
  documentType       String
  documentUrl        String?
  status             DocumentStatus       @default(NOT_UPLOADED)
  uploadedAt         DateTime?
  reviewStatus       DocumentReviewStatus @default(PENDING)
  reviewedBy         String?
  reviewedAt         DateTime?
  isReadable         Boolean?
  isExpired          Boolean?
  expiryDate         DateTime?
  verificationMethod String?
  verificationScore  Int?
  issues             Json?
  feedback           String?
  rejectionReason    String?
  requestedAt        DateTime?
  remindersSent      Int                  @default(0)
  lastReminderAt     DateTime?
  resubmissionCount  Int                  @default(0)
  lastResubmittedAt  DateTime?
  expiryWarningAt    DateTime?
  autoSuspendAt      DateTime?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  host               RentalHost           @relation(fields: [hostId], references: [id])

  @@unique([hostId, documentType])
  @@index([expiryDate])
  @@index([hostId])
  @@index([reviewStatus])
  @@index([status])
}

model HostESGProfile {
  id                      String        @id
  hostId                  String        @unique
  compositeScore          Int           @default(50)
  drivingImpactScore      Int           @default(50)
  emissionsScore          Int           @default(50)
  maintenanceScore        Int           @default(50)
  safetyScore             Int           @default(50)
  complianceScore         Int           @default(50)
  totalTrips              Int           @default(0)
  incidentFreeTrips       Int           @default(0)
  totalClaimsFiled        Int           @default(0)
  currentIncidentStreak   Int           @default(0)
  longestIncidentStreak   Int           @default(0)
  lastIncidentDate        DateTime?
  totalEVTrips            Int           @default(0)
  evTripPercentage        Float         @default(0)
  estimatedCO2Saved       Float         @default(0)
  fuelEfficiencyRating    String        @default("UNKNOWN")
  maintenanceOnTime       Boolean       @default(true)
  lastMaintenanceDate     DateTime?
  overdueMaintenanceCount Int           @default(0)
  fnolCompletionRate      Float         @default(100)
  avgResponseTimeHours    Float         @default(0)
  unauthorizedMileage     Float         @default(0)
  suspiciousActivityCount Int           @default(0)
  verificationFailures    Int           @default(0)
  fraudRiskLevel          String        @default("LOW")
  totalMilesDriven        Float         @default(0)
  avgMilesPerTrip         Float         @default(0)
  tripCompletionRate      Float         @default(100)
  idleTimeEfficiency      Float         @default(100)
  tripCancellationRate    Float         @default(0)
  lateReturnCount         Int           @default(0)
  earlyReturnCount        Int           @default(0)
  guestRatingAverage      Float         @default(5.0)
  totalVehicles           Int           @default(0)
  activeVehicles          Int           @default(0)
  evVehicleCount          Int           @default(0)
  avgVehicleAge           Float         @default(0)
  hasCommercialInsurance  Boolean       @default(false)
  hasP2PInsurance         Boolean       @default(false)
  insuranceTier           String        @default("PLATFORM")
  claimApprovalRate       Float         @default(0)
  avgClaimProcessingDays  Float         @default(0)
  achievedBadges          String[]      @default([])
  milestoneReached        String[]      @default([])
  nextMilestone           String?
  scoreHistory            Json          @default("[]")
  lastCalculatedAt        DateTime
  calculationVersion      String        @default("1.0")
  dataConfidence          String        @default("HIGH")
  createdAt               DateTime      @default(now())
  updatedAt               DateTime
  avgCO2PerMile           Float         @default(0)
  totalCO2Impact          Float         @default(0)
  snapshots               ESGSnapshot[]
  host                    RentalHost    @relation(fields: [hostId], references: [id], onDelete: Cascade)

  @@index([compositeScore])
  @@index([fraudRiskLevel])
  @@index([hostId])
  @@index([safetyScore])
}

model HostInquiry {
  id                String    @id
  name              String
  email             String
  phone             String
  vehicleMake       String
  vehicleModel      String
  vehicleYear       Int
  location          String    @default("Phoenix")
  message           String?
  mileage           Int?
  condition         String    @default("EXCELLENT")
  features          String?
  status            String    @default("NEW")
  source            String    @default("WEBSITE")
  contactedAt       DateTime?
  contactedBy       String?
  approvedAt        DateTime?
  approvedBy        String?
  rejectedAt        DateTime?
  rejectedBy        String?
  rejectionReason   String?
  convertedToHostId String?
  convertedAt       DateTime?
  metadata          Json?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  replies           Json?     @default("[]")
  replyCount        Int       @default(0)

  @@index([createdAt])
  @@index([email])
  @@index([status])
}

model HostNotification {
  id                  String             @id
  hostId              String
  type                String
  category            String
  subject             String
  message             String
  status              NotificationStatus @default(PENDING)
  sentAt              DateTime?
  readAt              DateTime?
  respondedAt         DateTime?
  emailSent           Boolean            @default(false)
  smsSent             Boolean            @default(false)
  pushSent            Boolean            @default(false)
  inAppShown          Boolean            @default(false)
  responseRequired    Boolean            @default(false)
  responseDeadline    DateTime?
  responseReceived    String?
  actionRequired      String?
  actionUrl           String?
  actionCompleted     Boolean            @default(false)
  relatedDocumentType String?
  relatedCheckType    String?
  reminderCount       Int                @default(0)
  lastReminderAt      DateTime?
  nextReminderAt      DateTime?
  priority            String             @default("normal")
  createdAt           DateTime           @default(now())
  updatedAt           DateTime
  actionLabel         String?
  expiresAt           DateTime?
  metadata            Json?
  host                RentalHost         @relation(fields: [hostId], references: [id])

  @@index([hostId])
  @@index([priority])
  @@index([responseDeadline])
  @@index([status])
  @@index([type])
}

model HostPayout {
  id               String        @id
  hostId           String
  bookingId        String
  amount           Decimal       @db.Decimal(10, 2)
  status           PayoutStatus  @default(PENDING)
  processedAt      DateTime?
  stripeTransferId String?
  createdAt        DateTime      @default(now())
  booking          RentalBooking @relation(fields: [bookingId], references: [id])
  host             RentalHost    @relation(fields: [hostId], references: [id])

  @@index([hostId])
  @@index([status])
}

model Hotel {
  id                  String             @id
  gdsCode             String             @unique
  name                String
  type                PropertyType
  size                HotelSize
  rooms               Int
  stars               Int?
  chain               String?
  address             String
  city                String
  state               String
  zip                 String
  country             String
  latitude            Float?
  longitude           Float?
  claimed             Boolean            @default(false)
  claimedBy           String?
  claimedAt           DateTime?
  certified           Boolean            @default(false)
  certificationTier   CertificationTier?
  certifiedAt         DateTime?
  certificationExpiry DateTime?
  active              Boolean            @default(true)
  pmsType             String?
  pmsConnected        Boolean            @default(false)
  channelManager      String?
  amenities           String?
  images              String?
  createdAt           DateTime           @default(now())
  updatedAt           DateTime
  ApiKey              ApiKey[]
  Booking             Booking[]
  HotelMetrics        HotelMetrics[]
  Revenue             Revenue[]
  Ride                Ride[]
  user                User[]

  @@index([certified])
  @@index([city, state])
  @@index([gdsCode])
}

model HotelMetrics {
  id               String       @id
  hotelId          String
  period           MetricPeriod
  startDate        DateTime
  endDate          DateTime
  occupancyRate    Float
  roomsOccupied    Int
  roomsAvailable   Int
  roomRevenue      Float
  rideRevenue      Float
  totalRevenue     Float
  totalRides       Int
  completedRides   Int
  cancelledRides   Int
  averageRideValue Float
  totalBookings    Int
  directBookings   Int
  otaBookings      Int
  averageStayDays  Float
  cancellationRate Float
  guestRating      Float?
  rideRating       Float?
  calculatedAt     DateTime     @default(now())
  Hotel            Hotel        @relation(fields: [hotelId], references: [id], onDelete: Cascade)

  @@unique([hotelId, period, startDate])
  @@index([hotelId])
}

model InspectionPhoto {
  id         String        @id
  bookingId  String
  type       String
  category   String
  url        String
  metadata   Json?
  uploadedAt DateTime      @default(now())
  booking    RentalBooking @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@index([type])
}

model InsuranceNotification {
  id      String   @id
  type    String
  sentTo  String[]
  subject String
  message String
  sentBy  String
  sentAt  DateTime @default(now())

  @@index([sentAt])
  @@index([type])
}

model InsurancePolicy {
  id                String            @id
  bookingId         String            @unique
  providerId        String
  tier              InsuranceTier
  liabilityCoverage Float             @default(750000)
  collisionCoverage Float
  deductible        Float
  dailyPremium      Float
  totalPremium      Float
  platformRevenue   Float
  increasedDeposit  Float?
  status            PolicyStatus
  policyNumber      String?
  effectiveDate     DateTime
  expiryDate        DateTime
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  boundViaApi       Boolean           @default(false)
  externalPolicyId  String?
  hostTier          String?
  policySnapshot    Json?
  policySource      String?
  primaryParty      String?
  Claim             Claim[]
  booking           RentalBooking     @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  InsuranceProvider InsuranceProvider @relation(fields: [providerId], references: [id])

  @@index([bookingId])
  @@index([providerId])
  @@index([status])
}

model InsuranceProvider {
  id                       String                     @id
  name                     String
  type                     InsuranceProviderType
  isActive                 Boolean                    @default(true)
  isPrimary                Boolean                    @default(false)
  coverageTiers            Json
  pricingRules             Json
  apiKey                   String?
  apiEndpoint              String?
  webhookUrl               String?
  revenueShare             Float                      @default(0.30)
  contractStart            DateTime?
  contractEnd              DateTime?
  contractTerms            String?
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  apiEndpointPlaceholder   String?
  contactEmail             String?
  contactPhone             String?
  contractEndDate          DateTime?
  contractStartDate        DateTime?
  coverageNotes            String?
  excludedMakes            String[]                   @default([])
  excludedModels           String[]                   @default([])
  vehicleValueMax          Float?
  vehicleValueMin          Float?
  vehicleRules             Json?
  InsurancePolicy          InsurancePolicy[]
  InsuranceRateHistory     InsuranceRateHistory[]
  ProviderDocument         ProviderDocument[]
  ProviderMessage          ProviderMessage[]
  RentalHost               RentalHost[]
  VehicleClassification    VehicleClassification[]
  VehicleCoverageOverride  VehicleCoverageOverride[]
  VehicleInsuranceOverride VehicleInsuranceOverride[]

  @@index([isActive])
  @@index([isPrimary])
}

model InsuranceRateHistory {
  id                String            @id
  providerId        String
  tier              String
  vehicleClass      String
  oldRate           Float
  newRate           Float
  effectiveDate     DateTime
  changedBy         String
  reason            String?
  createdAt         DateTime          @default(now())
  change            Float
  changePercent     Float?
  changeType        String
  InsuranceProvider InsuranceProvider @relation(fields: [providerId], references: [id])

  @@index([effectiveDate])
  @@index([providerId])
  @@index([tier])
  @@index([vehicleClass])
}

model JobApplication {
  id                String            @id
  jobId             String
  firstName         String
  lastName          String
  email             String
  phone             String
  linkedin          String?
  github            String?
  portfolio         String?
  website           String?
  resumeUrl         String
  coverLetter       String?
  coverLetterUrl    String?
  additionalDocsUrl String?
  yearsExperience   Int?
  currentCompany    String?
  currentTitle      String?
  expectedSalary    Int?
  availableDate     DateTime?
  screeningAnswers  Json?
  status            ApplicationStatus @default(NEW)
  stage             String?
  rating            Int?
  notes             String?
  reviewedBy        String?
  reviewedAt        DateTime?
  lastContactedAt   DateTime?
  interviewDate     DateTime?
  offerDate         DateTime?
  offerAmount       Int?
  source            String?
  referredBy        String?
  utmSource         String?
  utmMedium         String?
  utmCampaign       String?
  rejectionReason   String?
  withdrawnReason   String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  JobPosting        JobPosting        @relation(fields: [jobId], references: [id])

  @@unique([jobId, email])
  @@index([createdAt])
  @@index([email])
  @@index([jobId])
  @@index([status])
}

model JobPosting {
  id                 String           @id
  title              String
  department         String
  location           String
  type               JobType
  description        String
  requirements       String
  responsibilities   String
  qualifications     String?
  benefits           String?
  salaryMin          Int?
  salaryMax          Int?
  salaryPeriod       String?          @default("yearly")
  showSalary         Boolean          @default(true)
  equity             String?
  experienceMin      Int?
  experienceMax      Int?
  experienceRequired String?
  isActive           Boolean          @default(true)
  isFeatured         Boolean          @default(false)
  isRemote           Boolean          @default(false)
  openPositions      Int              @default(1)
  applyUrl           String?
  applyEmail         String?
  views              Int              @default(0)
  applicationCount   Int              @default(0)
  postedDate         DateTime         @default(now())
  closingDate        DateTime?
  filledDate         DateTime?
  keywords           String?
  metadata           Json?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime
  JobApplication     JobApplication[]

  @@index([department])
  @@index([isActive])
  @@index([location])
  @@index([postedDate])
  @@index([type])
}

model LoginAttempt {
  id         String   @id
  identifier String
  userId     String?
  ipAddress  String
  userAgent  String
  success    Boolean
  reason     String?
  timestamp  DateTime @default(now())
  user       User?    @relation(fields: [userId], references: [id])

  @@index([identifier])
  @@index([ipAddress])
  @@index([success])
}

model MileageAnomaly {
  id               String    @id
  carId            String
  detectedAt       DateTime  @default(now())
  lastKnownMileage Int
  currentMileage   Int
  gapMiles         Int
  severity         String
  explanation      String?
  resolved         Boolean   @default(false)
  createdAt        DateTime  @default(now())
  car              RentalCar @relation(fields: [carId], references: [id], onDelete: Cascade)

  @@index([carId])
  @@index([detectedAt])
  @@index([resolved])
  @@index([severity])
}

model NotificationDismissal {
  id               String    @id
  userId           String
  notificationType String
  dismissedAt      DateTime  @default(now())
  dismissCount     Int       @default(1)
  completedAt      DateTime?
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, notificationType])
  @@index([dismissedAt])
  @@index([userId])
}

model PartnerVerificationRequest {
  id              String    @id
  partnerId       String
  guestId         String
  email           String
  name            String
  phone           String?
  purpose         String    @default("rental")
  bookingId       String?
  stripeSessionId String
  verificationUrl String
  status          String    @default("pending")
  verifiedAt      DateTime?
  expiresAt       DateTime?
  createdAt       DateTime  @default(now())

  @@index([createdAt])
  @@index([guestId])
  @@index([partnerId])
  @@index([status])
  @@index([stripeSessionId])
}

model PaymentMethod {
  id             String      @id
  hostId         String?
  type           String
  stripeMethodId String      @unique
  last4          String
  brand          String?
  accountType    String?
  isDefault      Boolean     @default(false)
  isVerified     Boolean     @default(false)
  verifiedAt     DateTime?
  nickname       String?
  metadata       Json?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime
  expiryMonth    Int?
  expiryYear     Int?
  holderName     String?
  status         String?     @default("active")
  userId         String?
  host           RentalHost? @relation(fields: [hostId], references: [id], onDelete: Cascade)
  user           User?       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([hostId])
  @@index([isDefault])
  @@index([stripeMethodId])
  @@index([userId])
}

model ProviderDocument {
  id                String            @id
  providerId        String
  name              String
  category          String
  fileUrl           String
  fileSize          Int
  fileType          String
  version           String            @default("1.0")
  previousVersionId String?
  description       String?
  uploadedBy        String
  expiresAt         DateTime?
  reminderSent      Boolean           @default(false)
  status            String            @default("active")
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  InsuranceProvider InsuranceProvider @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([expiresAt])
  @@index([providerId])
  @@index([status])
}

model ProviderMessage {
  id                String            @id
  providerId        String
  subject           String
  message           String
  category          String
  priority          String            @default("normal")
  sentBy            String
  sentByName        String
  direction         String
  attachments       Json?
  relatedClaimId    String?
  status            String            @default("sent")
  readAt            DateTime?
  replyToId         String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  InsuranceProvider InsuranceProvider @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([providerId])
  @@index([relatedClaimId])
  @@index([status])
}

model RateLimit {
  id              String    @id
  identifier      String    @unique
  tier            String
  requests        Int
  window          Int
  currentRequests Int       @default(0)
  windowStart     DateTime
  exceeded        Boolean   @default(false)
  banned          Boolean   @default(false)
  bannedUntil     DateTime?
  updatedAt       DateTime

  @@index([exceeded])
  @@index([identifier])
}

model RefundRequest {
  id               String        @id
  bookingId        String
  requestedBy      String
  requestedByType  String
  amount           Float
  reason           String
  status           String        @default("PENDING")
  reviewedBy       String?
  reviewedAt       DateTime?
  reviewNotes      String?
  processedAt      DateTime?
  stripeRefundId   String?
  stripeTransferId String?
  notes            String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime
  autoApproved     Boolean       @default(false)
  booking          RentalBooking @relation(fields: [bookingId], references: [id])

  @@index([bookingId])
  @@index([createdAt])
  @@index([requestedBy])
  @@index([status])
}

model RentalAvailability {
  id          String    @id
  carId       String
  date        DateTime  @db.Date
  isAvailable Boolean   @default(true)
  customPrice Float?
  note        String?
  car         RentalCar @relation(fields: [carId], references: [id], onDelete: Cascade)

  @@unique([carId, date])
  @@index([carId, date, isAvailable])
}

model RentalBooking {
  id                         String                @id
  bookingCode                String                @unique
  carId                      String
  hostId                     String
  renterId                   String?
  guestEmail                 String?
  guestPhone                 String?
  guestName                  String?
  verificationStatus         VerificationStatus    @default(PENDING)
  verificationDeadline       DateTime?
  verificationNotes          String?
  reviewedBy                 String?
  reviewedAt                 DateTime?
  documentsSubmittedAt       DateTime?
  hotelBookingId             String?
  startDate                  DateTime
  endDate                    DateTime
  startTime                  String
  endTime                    String
  pickupLocation             String
  pickupType                 String
  deliveryAddress            String?
  returnLocation             String?
  dailyRate                  Float
  numberOfDays               Int
  subtotal                   Float
  deliveryFee                Float                 @default(0)
  insuranceFee               Float                 @default(0)
  serviceFee                 Float
  taxes                      Float
  totalAmount                Float
  depositAmount              Float                 @default(500)
  pendingChargesAmount       Decimal?              @db.Decimal(10, 2)
  chargesProcessedAt         DateTime?
  finalReceiptSentAt         DateTime?
  chargesNotes               String?
  chargesWaivedAmount        Decimal?              @db.Decimal(10, 2)
  chargesWaivedReason        String?
  chargesAdjustedAmount      Decimal?              @db.Decimal(10, 2)
  status                     RentalBookingStatus   @default(PENDING)
  paymentStatus              PaymentStatus         @default(PENDING)
  paymentIntentId            String?
  stripeCustomerId           String?
  stripePaymentMethodId      String?
  stripeChargeId             String?
  stripeSetupIntentId        String?
  paymentFailureReason       String?
  paymentProcessedAt         DateTime?
  cancellationReason         String?
  cancelledBy                CancelledBy?
  cancelledAt                DateTime?
  licenseVerified            Boolean               @default(false)
  licenseNumber              String?
  licenseState               String?
  licenseExpiry              DateTime?
  licensePhotoUrl            String?
  insurancePhotoUrl          String?
  selfieVerified             Boolean               @default(false)
  selfiePhotoUrl             String?
  dateOfBirth                DateTime?
  bookingIpAddress           String?
  bookingUserAgent           String?
  bookingCountry             String?
  bookingCity                String?
  deviceFingerprint          String?
  sessionId                  String?
  sessionStartedAt           DateTime?
  sessionDuration            Int?
  riskScore                  Int?                  @default(0)
  riskFlags                  String?
  riskNotes                  String?
  fraudulent                 Boolean               @default(false)
  flaggedForReview           Boolean               @default(false)
  formCompletionTime         Int?
  fieldChangeCount           Int?
  copyPasteUsed              Boolean               @default(false)
  mouseEventsRecorded        Boolean               @default(false)
  emailVerified              Boolean               @default(false)
  emailDomain                String?
  phoneVerified              Boolean               @default(false)
  phoneCarrier               String?
  phoneType                  String?
  tripStatus                 TripStatus            @default(NOT_STARTED)
  pickupWindowStart          DateTime?
  pickupWindowEnd            DateTime?
  pickupLatitude             Float?
  pickupLongitude            Float?
  returnLatitude             Float?
  returnLongitude            Float?
  pickupLocationVerified     Boolean               @default(false)
  partnerLocationId          String?
  tripStartedAt              DateTime?
  tripEndedAt                DateTime?
  actualStartTime            DateTime?
  actualEndTime              DateTime?
  startMileage               Int?
  endMileage                 Int?
  fuelLevelStart             String?
  fuelLevelEnd               String?
  inspectionPhotosStart      String?
  inspectionPhotosEnd        String?
  damageReported             Boolean               @default(false)
  damageDescription          String?
  damagePhotos               String?
  extras                     String?
  notes                      String?
  createdAt                  DateTime              @default(now())
  updatedAt                  DateTime
  depositHeld                Float
  depositRefunded            Float?
  depositRefundedAt          DateTime?
  depositUsedForClaim        Float?
  securityDeposit            Float
  reviewerProfileId          String?
  guestInsuranceActive       Boolean               @default(false)
  guestInsurancePolicyNumber String?
  guestInsuranceProvider     String?
  insuranceHierarchy         Json?
  depositDiscountApplied     Boolean               @default(false)
  insuranceBoundAt           DateTime?
  insurancePolicyId          String?
  insuranceProvider          String?
  insuranceSelection         String?
  insuranceStatus            String?
  insuranceTier              String?
  platformPolicyActive       Boolean               @default(false)
  policySnapshot             Json?
  guestInsuranceApplied      Boolean               @default(false)
  guestInsuranceVerified     Boolean               @default(false)
  hostRevenueSplit           Int?
  adminCompletedById         String?
  adminCompletionNotes       String?
  tripCompletedBy            String?
  tripEndRequestedAt         DateTime?
  tripEndRequestedBy         String?
  tripEndRequestReason       String?
  tripEndRequestStatus       String?
  tripEndApprovedBy          String?
  tripEndApprovedAt          DateTime?
  tripEndDeniedReason        String?
  effectiveTaxRate           Float?
  pricingSnapshot            Json?
  serviceFeeRate             Float?
  settingsVersion            DateTime?
  creditsApplied             Float                 @default(0)
  bonusApplied               Float                 @default(0)
  depositFromWallet          Float                 @default(0)
  depositFromCard            Float                 @default(0)
  chargeAmount               Float?
  agreementExpiresAt         DateTime?
  agreementSentAt            DateTime?
  agreementSignedAt          DateTime?
  agreementSignedPdfUrl      String?
  agreementStatus            String?               @default("not_sent")
  agreementToken             String?               @unique
  agreementViewedAt          DateTime?
  signatureImageUrl          String?
  signerEmail                String?
  signerIpAddress            String?
  signerName                 String?
  signerUserAgent            String?
  BookingSession             BookingSession?
  ChargeAdjustment           ChargeAdjustment[]
  Claim                      Claim[]
  FraudIndicator             FraudIndicator[]
  GuestAccessToken           GuestAccessToken[]
  HostPayout                 HostPayout[]
  InspectionPhoto            InspectionPhoto[]
  InsurancePolicy            InsurancePolicy?
  RefundRequest              RefundRequest[]
  car                        RentalCar             @relation(fields: [carId], references: [id])
  host                       RentalHost            @relation(fields: [hostId], references: [id])
  renter                     User?                 @relation(fields: [renterId], references: [id])
  reviewerProfile            ReviewerProfile?      @relation(fields: [reviewerProfileId], references: [id])
  disputes                   RentalDispute[]
  messages                   RentalMessage[]
  RentalPayout               RentalPayout[]
  review                     RentalReview?
  tripCharges                TripCharge[]
  TripInspectionPhoto        TripInspectionPhoto[]
  TripIssue                  TripIssue?
  // Reservation request system relations
  reservationRequest         ReservationRequest?
  requestClaim               RequestClaim?
  // Converted from prospect (if booking came from recruitment)
  convertedFromProspect      HostProspect?         @relation("prospect_to_booking")

  @@index([adminCompletedById])
  @@index([agreementStatus])
  @@index([agreementToken])
  @@index([bookingIpAddress])
  @@index([carId])
  @@index([deviceFingerprint])
  @@index([fraudulent])
  @@index([guestEmail])
  @@index([hostId])
  @@index([paymentStatus])
  @@index([renterId])
  @@index([reviewerProfileId])
  @@index([riskScore])
  @@index([startDate, endDate])
  @@index([status])
  @@index([stripeCustomerId])
  @@index([tripCompletedBy])
  @@index([tripEndRequestStatus])
  @@index([tripStatus])
  @@index([verificationStatus])
}

model RentalCar {
  id                         String                     @id
  hostId                     String
  source                     String                     @default("p2p")
  externalId                 String?
  make                       String
  model                      String
  year                       Int
  trim                       String?
  color                      String
  licensePlate               String?
  vin                        String?
  carType                    String
  seats                      Int
  doors                      Int
  transmission               String
  fuelType                   String
  mpgCity                    Int?
  mpgHighway                 Int?
  currentMileage             Int?
  dailyRate                  Float
  weeklyRate                 Float?
  monthlyRate                Float?
  deliveryFee                Float                      @default(35)
  airportFee                 Float                      @default(0)
  hotelFee                   Float                      @default(35)
  homeFee                    Float                      @default(50)
  weeklyDiscount             Float?                     @default(0.15)
  monthlyDiscount            Float?                     @default(0.30)
  discountPercent            Float?                     @default(0)
  customDepositAmount        Float?
  noDeposit                  Boolean                    @default(false)
  vehicleDepositMode         String                     @default("global")
  features                   String
  address                    String
  city                       String
  state                      String
  zipCode                    String
  latitude                   Float?
  longitude                  Float?
  airportPickup              Boolean                    @default(false)
  hotelDelivery              Boolean                    @default(true)
  homeDelivery               Boolean                    @default(false)
  deliveryRadius             Int                        @default(10)
  freeDeliveryRadius         Int                        @default(0)
  deliveryInstructions       String?
  isActive                   Boolean                    @default(true)
  instantBook                Boolean                    @default(true)
  advanceNotice              Int                        @default(2)
  minTripDuration            Int                        @default(1)
  maxTripDuration            Int                        @default(30)
  bufferTime                 Int                        @default(2)
  cancellationPolicy         String                     @default("moderate")
  checkInTime                String                     @default("10:00")
  checkOutTime               String                     @default("10:00")
  mileageDaily               Int                        @default(200)
  mileageWeekly              Int                        @default(1000)
  mileageMonthly             Int                        @default(3000)
  mileageOverageFee          Float                      @default(3.0)
  rules                      String?
  insuranceIncluded          Boolean                    @default(false)
  insuranceDaily             Float                      @default(25)
  totalTrips                 Int                        @default(0)
  rating                     Float                      @default(5.0)
  createdAt                  DateTime                   @default(now())
  updatedAt                  DateTime
  classificationId           String?
  estimatedValue             Decimal?                   @db.Decimal(12, 2)
  insuranceCategory          String?
  insuranceEligible          Boolean                    @default(true)
  insuranceNotes             String?
  insuranceRiskLevel         String?
  requiresManualUnderwriting Boolean                    @default(false)
  activeClaimId              String?
  claimDeactivatedAt         DateTime?
  claimFreeMonths            Int                        @default(0)
  hasActiveClaim             Boolean                    @default(false)
  lastClaimDate              DateTime?
  totalClaimsCount           Int                        @default(0)
  claimLockUntil             DateTime?
  requiresInspection         Boolean                    @default(false)
  safetyHold                 Boolean                    @default(false)
  safetyHoldReason           String?
  repairVerified             Boolean                    @default(false)
  annualMileage              Int?                       @default(12000)
  garageAddress              String?
  garageCity                 String?
  garageState                String?
  garageZip                  String?
  hasAlarm                   Boolean                    @default(false)
  hasImmobilizer             Boolean                    @default(false)
  hasLien                    Boolean                    @default(false)
  hasTracking                Boolean                    @default(false)
  isModified                 Boolean                    @default(false)
  lienholderName             String?
  modifications              String?
  primaryUse                 String                     @default("Rental")
  registeredOwner            String?
  titleStatus                String                     @default("Clean")
  lienholderAddress          String?
  avgMilesPerTrip            Float?                     @default(0)
  avgResponseTime            Int?                       @default(0)
  esgEnvironmentalScore      Int?
  esgLastCalculated          DateTime?
  esgMaintenanceScore        Int?
  esgSafetyScore             Int?
  esgScore                   Int?                       @default(50)
  guestRatingAvg             Float?                     @default(5.0)
  lastOdometerCheck          DateTime?
  maintenanceCadence         Int?                       @default(90)
  mileageVariance            Float?                     @default(0)
  suspiciousMileageFlag      Boolean                    @default(false)
  highUsageInspectionNeeded  Boolean                    @default(false)
  inspectionExpired          Boolean                    @default(false)
  inspectionExpiresAt        DateTime?
  lastInspection             DateTime?
  lastOilChange              DateTime?
  nextInspectionDue          DateTime?
  nextOilChangeDue           DateTime?
  serviceOverdue             Boolean                    @default(false)
  lastRentalEndDate          DateTime?
  lastRentalEndMileage       Int?
  insuranceExpiryDate        DateTime?
  insuranceVerifiedAt        DateTime?
  insuranceVerifiedBy        String?
  registrationExpiryDate     DateTime?
  registrationVerifiedAt     DateTime?
  registrationVerifiedBy     String?
  titleVerifiedAt            DateTime?
  titleVerifiedBy            String?
  vinVerificationMethod      String?
  vinVerifiedAt              DateTime?
  vinVerifiedBy              String?
  registrationState          String?
  declarationType            String                     @default("Rental")
  description                String?
  vehicleType                VehicleType                @default(RENTAL)
  driveType                  String?
  MileageAnomaly             MileageAnomaly[]
  availability               RentalAvailability[]
  bookings                   RentalBooking[]
  VehicleClassification      VehicleClassification?     @relation(fields: [classificationId], references: [id])
  host                       RentalHost                 @relation(fields: [hostId], references: [id])
  photos                     RentalCarPhoto[]
  reviews                    RentalReview[]
  VehicleCoverageOverride    VehicleCoverageOverride[]
  VehicleInsuranceOverride   VehicleInsuranceOverride[]
  VehicleServiceRecord       VehicleServiceRecord[]
  vehicleManagement          VehicleManagement?
  requestClaims              RequestClaim[]
  smartcarVehicle            SmartcarVehicle?

  @@index([activeClaimId])
  @@index([carType])
  @@index([city, state])
  @@index([classificationId])
  @@index([hasActiveClaim])
  @@index([hasAlarm])
  @@index([hasLien])
  @@index([hasTracking])
  @@index([hostId])
  @@index([insuranceEligible])
  @@index([insuranceVerifiedBy])
  @@index([isActive, instantBook])
  @@index([isModified])
  @@index([lastClaimDate])
  @@index([make, model, year])
  @@index([registeredOwner])
  @@index([registrationVerifiedBy])
  @@index([titleStatus])
  @@index([totalClaimsCount])
  @@index([vinVerifiedBy])
  @@index([vin])
}

model RentalCarPhoto {
  id             String    @id
  carId          String
  url            String
  caption        String?
  isHero         Boolean   @default(false)
  order          Int       @default(0)
  createdAt      DateTime  @default(now())
  deletedAt      DateTime?
  deletedBy      String?
  deviceMake     String?
  deviceModel    String?
  gpsLatitude    Float?
  gpsLongitude   Float?
  metadata       Json?
  photoContext   String?
  photoHash      String?
  photoTimestamp DateTime?
  relatedClaimId String?
  uploadedBy     String?
  uploadedByType String?
  verified       Boolean   @default(false)
  verifiedAt     DateTime?
  verifiedBy     String?
  car            RentalCar @relation(fields: [carId], references: [id], onDelete: Cascade)

  @@index([carId])
  @@index([deletedAt])
  @@index([photoContext])
  @@index([photoHash])
  @@index([relatedClaimId])
  @@index([uploadedBy])
  @@index([verified])
}

model RentalDispute {
  id              String        @id
  bookingId       String
  type            DisputeType
  description     String
  status          DisputeStatus @default(OPEN)
  resolution      String?
  createdAt       DateTime      @default(now())
  resolvedAt      DateTime?
  reviewStartedAt DateTime?
  reviewedBy      String?
  booking         RentalBooking @relation(fields: [bookingId], references: [id])

  @@index([bookingId])
  @@index([status])
}

model RentalHost {
  id                            String                 @id
  userId                        String?                @unique
  email                         String                 @unique
  name                          String
  phone                         String
  profilePhoto                  String?
  bio                           String?
  isVerified                    Boolean                @default(false)
  verifiedAt                    DateTime?
  verificationLevel             String?
  responseTime                  Int?
  responseRate                  Float?
  acceptanceRate                Float?
  totalTrips                    Int                    @default(0)
  rating                        Float                  @default(5.0)
  city                          String
  state                         String
  zipCode                       String?
  active                        Boolean                @default(true)
  joinedAt                      DateTime               @default(now())
  createdAt                     DateTime               @default(now())
  updatedAt                     DateTime
  approvalStatus                String                 @default("PENDING")
  approvedAt                    DateTime?
  approvedBy                    String?
  autoApproveBookings           Boolean                @default(true)
  bankAccountInfo               String?
  bankVerified                  Boolean                @default(false)
  canEditCalendar               Boolean                @default(false)
  canMessageGuests              Boolean                @default(false)
  canSetPricing                 Boolean                @default(false)
  canViewBookings               Boolean                @default(false)
  canWithdrawFunds              Boolean                @default(false)
  commissionRate                Float                  @default(0.25)
  dashboardAccess               Boolean                @default(false)
  depositAmount                 Float                  @default(500)
  depositMode                   String                 @default("global")
  makeDeposits                  Json?
  globalDiscountPercent         Float?                 @default(0)
  documentsVerified             Boolean                @default(false)
  driversLicenseUrl             String?
  governmentIdUrl               String?
  hostType                      String                 @default("PENDING")
  insuranceDocUrl               String?
  maxDailyRate                  Float?
  minDailyRate                  Float?
  rejectedReason                String?
  requireDeposit                Boolean                @default(true)
  suspendedAt                   DateTime?
  suspendedReason               String?
  bankAccountLast4              String?
  bankAccountName               String?
  bankAccountType               String?                @default("checking")
  bankName                      String?
  businessName                  String?
  businessType                  String?
  debitCardExpMonth             Int?
  debitCardExpYear              Int?
  debitCardLast4                String?
  defaultPayoutMethod           String?
  instantPayoutEnabled          Boolean                @default(false)
  lastPayoutAmount              Float?
  lastPayoutDate                DateTime?
  nextScheduledPayout           DateTime?
  payoutFrequency               String?                @default("weekly")
  payoutScheduleDay             String?                @default("Friday")
  protectionPlan                String?                @default("BASIC")
  protectionPlanFee             Float?
  stripeAccountId               String?
  stripeAccountStatus           String?                @default("pending")
  stripeChargesEnabled          Boolean                @default(false)
  stripeDetailsSubmitted        Boolean                @default(false)
  stripePayoutsEnabled          Boolean                @default(false)
  stripeTosAcceptanceDate       DateTime?
  stripeTosAcceptanceIp         String?
  taxIdType                     String?
  totalPayoutAmount             Float?                 @default(0)
  totalPayoutCount              Int?                   @default(0)
  backgroundCheckStatus         String?
  documentStatuses              Json?
  documentsRequestedAt          DateTime?
  documentsResubmittedAt        DateTime?
  lastNotificationSent          DateTime?
  pendingActions                String[]               @default([])
  restrictionReasons            String[]               @default([])
  bankAccountToken              String?
  bankVerifiedDate              DateTime?
  currentBalance                Float                  @default(0)
  debitCardBrand                String?
  debitCardToken                String?
  debitCardVerified             Boolean                @default(false)
  defaultPayoutMethodId         String?
  holdFundsUntil                DateTime?
  holdReason                    String?
  instantPayoutFeeRate          Float                  @default(0.015)
  minimumPayoutAmount           Float                  @default(50.00)
  payoutMethods                 Json?
  payoutSchedule                String                 @default("weekly")
  payoutsDisabledReason         String?
  payoutsEnabled                Boolean                @default(false)
  pendingBalance                Float                  @default(0)
  platformFeeRate               Float                  @default(0.25)
  stripeConnectAccountId        String?                @unique
  stripeOnboardingLink          String?
  taxIdProvided                 Boolean                @default(false)
  totalEarnings                 Float                  @default(0)
  totalPayoutsAmount            Float                  @default(0)
  totalPayoutsCount             Int                    @default(0)
  w9Submitted                   Boolean                @default(false)
  w9SubmittedDate               DateTime?
  defaultPaymentMethodOnFile    String?
  holdBalance                   Float                  @default(0)
  lastChargeReason              String?
  lastChargedDate               DateTime?
  lastSubscriptionChargeDate    DateTime?
  monthlySubscriptionFee        Float                  @default(0)
  negativeBalance               Float                  @default(0)
  nextSubscriptionChargeDate    DateTime?
  stripeCustomerId              String?                @unique
  subscriptionEndDate           DateTime?
  subscriptionStartDate         DateTime?
  subscriptionStatus            String                 @default("ACTIVE")
  subscriptionTier              String                 @default("FREE")
  totalChargedAmount            Float                  @default(0)
  deactivationReason            String?
  hostInsuranceDeactivatedAt    DateTime?
  hostInsuranceExpires          DateTime?
  hostInsuranceProvider         String?
  hostInsuranceStatus           HostInsuranceStatus    @default(ACTIVE)
  hostPolicyNumber              String?
  insuranceHistory              Json?
  insuranceActive               Boolean                @default(false)
  insuranceAssignedAt           DateTime?
  insuranceAssignedBy           String?
  insurancePolicyNumber         String?
  insuranceProviderId           String?
  commercialInsuranceActive     Boolean                @default(false)
  commercialInsuranceExpires    DateTime?
  commercialInsuranceProvider   String?
  commercialInsuranceStatus     InsuranceStatus?
  commercialPolicyNumber        String?
  earningsTier                  EarningsTier           @default(BASIC)
  lastTierChange                DateTime?
  p2pInsuranceActive            Boolean                @default(false)
  p2pInsuranceExpires           DateTime?
  p2pInsuranceProvider          String?
  p2pInsuranceStatus            InsuranceStatus?
  p2pPolicyNumber               String?
  tierChangeBy                  String?
  tierChangeReason              String?
  usingLegacyInsurance          Boolean                @default(true)
  insuranceType                 String                 @default("none")
  revenueSplit                  Int                    @default(40)
  suspensionExpiresAt           DateTime?
  legacyDualId                  String?
  autoApproveListings           Boolean                @default(true)
  currentCommissionRate         Float                  @default(0.25)
  partnerAvgRating              Float                  @default(0)
  partnerBio                    String?
  partnerCompanyName            String?
  partnerFleetSize              Int                    @default(0)
  partnerLogo                   String?
  partnerPayoutSchedule         PartnerPayoutSchedule?
  partnerSlug                   String?                @unique
  partnerSupportEmail           String?
  partnerSupportPhone           String?
  partnerTotalBookings          Int                    @default(0)
  partnerTotalRevenue           Float                  @default(0)
  tier1CommissionRate           Float                  @default(0.20)
  tier1VehicleCount             Int                    @default(10)
  tier2CommissionRate           Float                  @default(0.15)
  tier2VehicleCount             Int                    @default(50)
  tier3CommissionRate           Float                  @default(0.10)
  tier3VehicleCount             Int                    @default(100)
  businessHours                 String?
  partnerBadges                 Json?
  partnerBenefits               Json?
  partnerHeroImage              String?
  partnerHeroImageFilter        Boolean                @default(false)
  partnerPolicies               Json?
  yearEstablished               Int?
  photoIdType                   String?
  photoIdUrls                   Json?
  photoIdVerified               Boolean                @default(false)
  photoIdSubmittedAt            DateTime?
  hostManagerBio                String?
  hostManagerLogo               String?
  hostManagerName               String?
  hostManagerSlug               String?                @unique
  isHostManager                 Boolean                @default(false)
  isVehicleOwner                Boolean                @default(false)
  managesOthersCars             Boolean                @default(false)
  managesOwnCars                Boolean                @default(true)
  stripeDisabledReason          String?
  stripeRequirements            Json?
  partnerWebsite                String?
  partnerInstagram              String?
  partnerFacebook               String?
  partnerTwitter                String?
  partnerLinkedIn               String?
  partnerTikTok                 String?
  partnerYouTube                String?
  partnerShowEmail              Boolean                @default(true)
  partnerShowPhone              Boolean                @default(true)
  partnerShowWebsite            Boolean                @default(true)
  partnerHeroTitle              String?
  partnerHeroSubtitle           String?
  partnerPrimaryColor           String?
  referralBonusEarned           Float                  @default(0)
  referralCode                  String?                @unique
  referralCount                 Int                    @default(0)
  referredByHostId              String?
  enableLeasing                 Boolean                @default(false)
  enableRentToOwn               Boolean                @default(false)
  enableRentals                 Boolean                @default(false)
  enableRideshare               Boolean                @default(true)
  enableSales                   Boolean                @default(false)
  partnerServices               Json?
  vehicleApprovalMode           String                 @default("DYNAMIC")
  vehicleApprovalThreshold      Int                    @default(25)
  emailVerified                 Boolean                @default(false)
  emailVerifiedAt               DateTime?
  identityVerificationSessionId String?
  identityVerified              Boolean                @default(false)
  identityVerifiedAt            DateTime?
  phoneVerified                 Boolean                @default(false)
  phoneVerifiedAt               DateTime?
  lastLoginAt                   DateTime?
  previousLoginAt               DateTime?
  // External recruitment tracking
  isExternalRecruit             Boolean                @default(false)
  recruitedVia                  String? // FB_MARKETPLACE, TURO, REFERRAL, etc.
  recruitedAt                   DateTime?
  agreementTemplateCustom       Json?

  // 
  // RECRUITED HOST ONBOARDING (request-based flow)
  // 
  isRecruitedRequest Boolean @default(false) // Came from recruitment email link
  hasPassword        Boolean @default(true) // false = token-only access
  linkedProspectId   String? // References the HostProspect they came from

  // Token-based access (for recruited hosts without password)
  hostAccessToken     String?   @unique // Token for passwordless access
  hostAccessTokenExp  DateTime? // 7 days from creation
  hostTokenLastUsedAt DateTime? // Last access timestamp
  hostTokenUsedFromIp String? // IP tracking

  // Onboarding status
  onboardingStartedAt        DateTime? // When they clicked "Start"
  onboardingCompletedAt      DateTime? // When all required steps done
  declinedRequestAt          DateTime? // If they declined the request
  declineReason              String? // Optional reason
  BackgroundCheck            BackgroundCheck[]
  Claim                      Claim[]
  HostDocumentStatus         HostDocumentStatus[]
  HostESGProfile             HostESGProfile?
  HostNotification           HostNotification[]
  HostPayout                 HostPayout[]
  PaymentMethod              PaymentMethod[]
  bookings                   RentalBooking[]
  cars                       RentalCar[]
  insuranceProvider          InsuranceProvider?           @relation(fields: [insuranceProviderId], references: [id])
  user                       User?                        @relation(fields: [userId], references: [id])
  RentalPayout               RentalPayout[]
  reviews                    RentalReview[]
  host_charges               host_charges[]
  receivedInvitations        ManagementInvitation[]       @relation("management_invitations_recipientIdToRentalHost")
  sentInvitations            ManagementInvitation[]       @relation("management_invitations_senderIdToRentalHost")
  partner_applications       partner_applications?
  partner_commission_history partner_commission_history[]
  partnerDiscounts           partner_discounts[]
  partner_documents          partner_documents[]
  partnerFaqs                partner_faqs[]
  partner_payouts            partner_payouts[]
  managedVehicles            VehicleManagement[]          @relation("vehicle_management_managerIdToRentalHost")
  ownedVehicles              VehicleManagement[]          @relation("vehicle_management_ownerIdToRentalHost")
  // Reservation request system relations
  requestClaims              RequestClaim[]
  convertedFromProspect      HostProspect?                @relation("prospect_to_host")
  // Smartcar vehicle tracking
  smartcarVehicles           SmartcarVehicle[]

  @@index([approvalStatus])
  @@index([city, state])
  @@index([commercialInsuranceStatus])
  @@index([earningsTier])
  @@index([email])
  @@index([hostInsuranceStatus])
  @@index([hostManagerSlug])
  @@index([hostType])
  @@index([insuranceProviderId])
  @@index([isHostManager])
  @@index([isVehicleOwner])
  @@index([isExternalRecruit])
  @@index([isRecruitedRequest])
  @@index([hostAccessToken])
  @@index([linkedProspectId])
  @@index([legacyDualId])
  @@index([p2pInsuranceStatus])
  @@index([partnerSlug])
  @@index([payoutsEnabled])
  @@index([stripeAccountId])
  @@index([stripeConnectAccountId])
  @@index([stripeCustomerId])
  @@index([usingLegacyInsurance])
}

model RentalMessage {
  id             String        @id
  bookingId      String
  senderId       String
  senderType     String
  message        String
  isRead         Boolean       @default(false)
  senderName     String?
  senderEmail    String?
  category       String        @default("general")
  hasAttachment  Boolean       @default(false)
  attachmentUrl  String?
  attachmentName String?
  isUrgent       Boolean       @default(false)
  readByAdmin    Boolean       @default(false)
  adminNotes     String?
  readAt         DateTime?
  metadata       Json?
  replyToId      String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime
  booking        RentalBooking @relation(fields: [bookingId], references: [id])

  @@index([bookingId])
  @@index([category])
  @@index([createdAt])
  @@index([isRead, readByAdmin])
  @@index([senderType])
}

model RentalPayout {
  id               String         @id
  hostId           String
  amount           Float
  currency         String         @default("USD")
  status           String
  startDate        DateTime
  endDate          DateTime
  bookingCount     Int
  grossEarnings    Float
  platformFee      Float
  processingFee    Float
  netPayout        Float
  paymentMethod    String?
  paymentDetails   String?
  transactionId    String?
  stripeTransferId String?
  createdAt        DateTime       @default(now())
  processedAt      DateTime?
  bookingId        String?
  eligibleAt       DateTime?
  updatedAt        DateTime
  booking          RentalBooking? @relation(fields: [bookingId], references: [id])
  host             RentalHost     @relation(fields: [hostId], references: [id])

  @@index([eligibleAt, status])
  @@index([hostId])
  @@index([hostId, status, processedAt])
  @@index([status])
}

model RentalReview {
  id                 String           @id
  bookingId          String?          @unique
  carId              String
  hostId             String
  renterId           String?
  reviewerProfileId  String?
  source             ReviewSource     @default(GUEST)
  rating             Int
  cleanliness        Int?
  accuracy           Int?
  communication      Int?
  convenience        Int?
  value              Int?
  title              String?
  comment            String?
  hostResponse       String?
  hostRespondedAt    DateTime?
  supportResponse    String?
  supportRespondedAt DateTime?
  supportRespondedBy String?
  tripStartDate      DateTime?
  tripEndDate        DateTime?
  isVisible          Boolean          @default(true)
  isPinned           Boolean          @default(false)
  isVerified         Boolean          @default(false)
  helpfulCount       Int              @default(0)
  viewCount          Int              @default(0)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime
  booking            RentalBooking?   @relation(fields: [bookingId], references: [id])
  car                RentalCar        @relation(fields: [carId], references: [id])
  host               RentalHost       @relation(fields: [hostId], references: [id])
  reviewerProfile    ReviewerProfile? @relation(fields: [reviewerProfileId], references: [id])

  @@index([carId])
  @@index([hostId])
  @@index([isPinned])
  @@index([isVisible])
  @@index([source])
  @@index([tripStartDate])
}

model Revenue {
  id               String        @id
  hotelId          String
  period           RevenuePeriod
  startDate        DateTime
  endDate          DateTime
  rideCount        Int
  rideGross        Float
  rideCommission   Float
  platformFee      Float
  rideNet          Float
  bookingCount     Int
  bookingValue     Float
  savedCommission  Float
  totalRevenue     Float
  currency         String        @default("USD")
  status           RevenueStatus
  availableBalance Float
  pendingBalance   Float
  calculatedAt     DateTime      @default(now())
  Hotel            Hotel         @relation(fields: [hotelId], references: [id])

  @@unique([hotelId, period, startDate])
  @@index([hotelId])
  @@index([status])
}

model ReviewTemplate {
  id              String   @id
  carType         String
  scenario        String
  tone            String
  titleTemplate   String
  commentTemplate String
  usageCount      Int      @default(0)
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime

  @@index([carType])
  @@index([isActive])
  @@index([scenario])
}

model ReviewerProfile {
  id                       String                   @id
  email                    String?                  @unique
  name                     String
  profilePhotoUrl          String?
  memberSince              DateTime                 @default(now())
  city                     String
  state                    String                   @default("AZ")
  tripCount                Int                      @default(0)
  reviewCount              Int                      @default(0)
  isVerified               Boolean                  @default(false)
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime
  userId                   String?                  @unique
  averageRating            Float                    @default(0)
  bio                      String?
  canInstantBook           Boolean                  @default(false)
  dateOfBirth              DateTime?
  documentVerifiedAt       DateTime?
  documentVerifiedBy       String?
  documentsVerified        Boolean                  @default(false)
  driversLicenseUrl        String?
  emailNotifications       Boolean                  @default(true)
  emailVerified            Boolean                  @default(false)
  emergencyContactName     String?
  emergencyContactPhone    String?
  emergencyContactRelation String?
  fullyVerified            Boolean                  @default(false)
  governmentIdType         GovernmentIdType?
  governmentIdUrl          String?
  insuranceCardUrl         String?
  insuranceProvider        String?
  insuranceVerified        Boolean                  @default(false)
  insuranceVerifiedAt      DateTime?
  loyaltyPoints            Int                      @default(0)
  memberTier               MemberTier               @default(BRONZE)
  phoneNumber              String?
  phoneVerified            Boolean                  @default(false)
  preferredCurrency        String                   @default("USD")
  preferredLanguage        String                   @default("en")
  pushNotifications        Boolean                  @default(true)
  selfieUrl                String?
  smsNotifications         Boolean                  @default(true)
  totalTrips               Int                      @default(0)
  zipCode                  String?
  address                  String?
  profileCompletion        Int                      @default(0)
  autoReactivate           Boolean                  @default(false)
  banReason                String?
  bannedAt                 DateTime?
  bannedBy                 String?
  lastWarningAt            DateTime?
  notificationSent         Boolean                  @default(false)
  notifiedAt               DateTime?
  suspendedAt              DateTime?
  suspendedBy              String?
  suspendedReason          String?
  suspensionExpiresAt      DateTime?
  suspensionLevel          SuspensionLevel?
  warningCount             Int                      @default(0)
  activeWarningCount       Int                      @default(0)
  canBookLuxury            Boolean                  @default(true)
  canBookPremium           Boolean                  @default(true)
  requiresManualApproval   Boolean                  @default(false)
  coverageType             String?
  customCoverage           String?
  expiryDate               DateTime?
  hasRideshare             Boolean                  @default(false)
  insuranceAddedAt         DateTime?
  insuranceCardBackUrl     String?
  insuranceCardFrontUrl    String?
  insuranceNotes           String?
  insuranceUpdatedAt       DateTime?
  insuranceVerifiedBy      String?
  policyNumber             String?
  lastPasswordReset        DateTime?
  passwordResetAttempts    Int                      @default(0)
  passwordResetLastAttempt DateTime?
  resetToken               String?                  @unique
  resetTokenExpiry         DateTime?
  resetTokenUsed           Boolean                  @default(false)
  accountHoldAppliedAt     DateTime?
  accountHoldClaimId       String?
  accountHoldReason        String?
  accountOnHold            Boolean                  @default(false)
  driverLicenseExpiry      DateTime?
  driverLicenseNumber      String?
  driverLicenseState       String?
  legacyDualId             String?
  referralBonusEarned      Float                    @default(0)
  referralCode             String?                  @unique
  referralCount            Int                      @default(0)
  referredByGuestId        String?
  bonusBalance             Float                    @default(0)
  creditBalance            Float                    @default(0)
  depositWalletBalance     Float                    @default(0)
  stripeCustomerId         String?                  @unique
  stripeIdentityReportId   String?
  stripeIdentitySessionId  String?
  stripeIdentityStatus     String?
  stripeIdentityVerifiedAt DateTime?
  stripeVerifiedAddress    String?
  stripeVerifiedDob        DateTime?
  stripeVerifiedFirstName  String?
  stripeVerifiedIdExpiry   DateTime?
  stripeVerifiedIdNumber   String?
  stripeVerifiedLastName   String?
  AccountHold              AccountHold[]
  AppealNotification       AppealNotification[]
  CreditBonusTransaction   CreditBonusTransaction[]
  DepositTransaction       DepositTransaction[]
  GuestAppeal              GuestAppeal[]
  GuestInsurance           GuestInsurance[]
  moderationHistory        GuestModeration[]
  GuestProfileStatus       GuestProfileStatus?
  RentalBooking            RentalBooking[]
  RentalReview             RentalReview[]
  user                     User?                    @relation(fields: [userId], references: [id])
  insuranceHistory         InsuranceHistory[]

  // Guest recruitment tracking
  recruitedVia             String? // 'guest_invite' | null
  recruitedAt              DateTime?
  guestProspect            GuestProspect? // Relation back to prospect

  @@index([accountHoldClaimId])
  @@index([accountOnHold])
  @@index([activeWarningCount])
  @@index([bannedAt])
  @@index([canBookLuxury])
  @@index([canBookPremium])
  @@index([canInstantBook])
  @@index([city, state])
  @@index([documentsVerified])
  @@index([driverLicenseExpiry])
  @@index([driverLicenseNumber])
  @@index([email])
  @@index([expiryDate])
  @@index([fullyVerified])
  @@index([insuranceVerified])
  @@index([legacyDualId])
  @@index([memberTier])
  @@index([requiresManualApproval])
  @@index([resetToken])
  @@index([stripeCustomerId])
  @@index([suspendedAt])
  @@index([suspensionExpiresAt])
  @@index([suspensionLevel])
  @@index([userId])
  @@index([userId, suspensionLevel])
  @@index([warningCount])
}

model Ride {
  id              String     @id
  hotelId         String
  bookingId       String?
  guestId         String?
  driverId        String?
  pickupAddress   String
  pickupLat       Float?
  pickupLng       Float?
  pickupTime      DateTime
  pickupType      String
  dropoffAddress  String
  dropoffLat      Float?
  dropoffLng      Float?
  dropoffTime     DateTime?
  dropoffType     String
  status          RideStatus
  isGhost         Boolean    @default(false)
  basePrice       Float
  distancePrice   Float
  timePrice       Float
  surgeMultiplier Float      @default(1.0)
  totalPrice      Float
  currency        String     @default("USD")
  hotelCommission Float
  driverEarnings  Float
  platformFee     Float      @default(0)
  trackingUrl     String?
  distance        Float?
  duration        Int?
  ghostData       String?
  requestedAt     DateTime   @default(now())
  completedAt     DateTime?
  Booking         Booking?   @relation(fields: [bookingId], references: [id])
  Driver          Driver?    @relation(fields: [driverId], references: [id])
  Guest           Guest?     @relation(fields: [guestId], references: [id])
  Hotel           Hotel      @relation(fields: [hotelId], references: [id])

  @@index([hotelId])
  @@index([isGhost])
  @@index([status])
}

model SecurityEvent {
  id             String         @id
  type           String
  severity       ThreatSeverity
  sourceIp       String
  userAgent      String
  country        String?
  city           String?
  targetResource String?
  targetId       String?
  message        String
  details        String?
  stackTrace     String?
  action         String
  blocked        Boolean        @default(false)
  timestamp      DateTime       @default(now())

  @@index([severity])
  @@index([sourceIp])
  @@index([timestamp])
  @@index([type])
  @@index([type, severity, timestamp]) // Uptime tracking queries
  @@index([blocked, timestamp]) // Failed request tracking
}

model MonitoringAlert {
  id             String         @id @default(cuid())
  type           String // security, performance, error_rate, availability, business, fraud
  severity       ThreatSeverity
  status         String         @default("active") // active, acknowledged, resolved, false_positive
  title          String
  message        String         @db.Text
  source         String? // Which system triggered this
  metadata       Json? // Additional context
  acknowledgedAt DateTime?
  acknowledgedBy String?
  resolvedAt     DateTime?
  resolvedBy     String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  @@index([status])
  @@index([severity])
  @@index([type])
  @@index([createdAt])
}

model Session {
  id           String    @id @default(cuid())
  userId       String?
  token        String    @unique
  refreshToken String?   @unique
  tokenFamily  String?
  ipAddress    String
  userAgent    String
  deviceId     String?
  fingerprint  String?
  expiresAt    DateTime
  revokedAt    DateTime?
  createdAt    DateTime  @default(now())
  lastActivity DateTime  @default(now())
  user         User?     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([refreshToken])
  @@index([token])
  @@index([userId])
}

// Short-lived session tokens for guest invite callback flow
// Used to pass auth tokens from validate API to callback route
model GuestSession {
  id           String    @id @default(cuid())
  token        String    @unique
  userId       String
  accessToken  String    @db.Text
  refreshToken String    @db.Text
  expiresAt    DateTime
  consumed     Boolean   @default(false)
  consumedAt   DateTime?
  createdAt    DateTime  @default(now())

  @@index([token])
  @@index([expiresAt])
}

model Threat {
  id              String         @id
  type            AttackType
  severity        ThreatSeverity
  status          ThreatStatus
  sourceIp        String
  sourceIps       String?
  country         String?
  asn             String?
  reputation      Int?
  method          String
  target          String
  payload         String?
  attempts        Int
  detectionMethod String
  confidence      Float
  rules           String?
  automated       Boolean
  actions         String?
  blockedUntil    DateTime?
  firstSeen       DateTime
  lastSeen        DateTime
  createdAt       DateTime       @default(now())
  updatedAt       DateTime

  @@index([severity])
  @@index([sourceIp])
  @@index([status])
  @@index([type])
}

model Transaction {
  id          String            @id
  hotelId     String
  type        TransactionType
  category    String
  amount      Float
  currency    String            @default("USD")
  rideId      String?
  bookingId   String?
  status      TransactionStatus
  description String
  metadata    String?
  createdAt   DateTime          @default(now())
  processedAt DateTime?

  @@index([hotelId])
  @@index([status])
  @@index([type])
}

model TripCharge {
  id                 String             @id
  bookingId          String
  mileageCharge      Decimal            @db.Decimal(10, 2)
  fuelCharge         Decimal            @db.Decimal(10, 2)
  lateCharge         Decimal            @db.Decimal(10, 2)
  damageCharge       Decimal            @db.Decimal(10, 2)
  cleaningCharge     Decimal            @db.Decimal(10, 2)
  otherCharges       Decimal            @db.Decimal(10, 2)
  totalCharges       Decimal            @db.Decimal(10, 2)
  chargeDetails      String?
  chargeStatus       ChargeStatus       @default(PENDING)
  chargeAttempts     Int                @default(0)
  lastAttemptAt      DateTime?
  nextRetryAt        DateTime?
  disputes           String?
  disputeNotes       String?
  disputedAt         DateTime?
  disputeResolvedAt  DateTime?
  disputeResolution  String?
  stripeChargeId     String?
  chargedAt          DateTime?
  chargedAmount      Decimal?           @db.Decimal(10, 2)
  failureReason      String?
  failureCode        String?
  originalAmount     Decimal?           @db.Decimal(10, 2)
  adjustedAmount     Decimal?           @db.Decimal(10, 2)
  waivedAt           DateTime?
  waivedBy           String?
  waivedByAdminId    String?
  processedByAdminId String?
  waiveReason        String?
  waivePercentage    Int?
  adjustmentNotes    String?
  adjustmentRecord   Json?
  refundAmount       Decimal?           @db.Decimal(10, 2)
  refundedAt         DateTime?
  refundReason       String?
  stripeRefundId     String?
  reviewedBy         String?
  reviewedAt         DateTime?
  adminNotes         String?
  requiresApproval   Boolean            @default(false)
  approvedBy         String?
  approvedAt         DateTime?
  holdUntil          DateTime?
  guestNotifiedAt    DateTime?
  reminderSentAt     DateTime?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  ChargeAdjustment   ChargeAdjustment[]
  booking            RentalBooking      @relation(fields: [bookingId], references: [id])

  @@index([bookingId])
  @@index([chargeStatus])
  @@index([holdUntil])
  @@index([requiresApproval])
}

model TripInspectionPhoto {
  id             String        @id
  bookingId      String
  photoType      String
  category       String
  url            String
  caption        String?
  uploadedBy     String
  uploadedByType String
  uploadedAt     DateTime      @default(now())
  gpsLatitude    Float?
  gpsLongitude   Float?
  photoTimestamp DateTime?
  createdAt      DateTime      @default(now())
  booking        RentalBooking @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@index([bookingId])
  @@index([photoType])
  @@index([uploadedAt])
}

model TripIssue {
  id                  String        @id
  bookingId           String        @unique
  hostReportedAt      DateTime?
  hostDescription     String?
  hostPhotos          Json?
  hostEstimatedCost   Float?
  guestReportedAt     DateTime?
  guestDescription    String?
  guestPhotos         Json?
  issueType           String
  severity            String
  tripStartMileage    Int?
  tripEndMileage      Int?
  tripStartFuel       String?
  tripEndFuel         String?
  startPhotosRef      Json?
  endPhotosRef        Json?
  status              String        @default("OPEN")
  guestAcknowledgedAt DateTime?
  guestAckNotes       String?
  hostReviewedAt      DateTime?
  hostReviewNotes     String?
  resolvedAt          DateTime?
  resolvedBy          String?
  resolution          String?
  claimId             String?       @unique
  escalationDeadline  DateTime?
  autoEscalated       Boolean       @default(false)
  hostNotifiedAt      DateTime?
  guestNotifiedAt     DateTime?
  reminderSentAt      DateTime?
  createdAt           DateTime      @default(now())
  updatedAt           DateTime
  booking             RentalBooking @relation(fields: [bookingId], references: [id])
  claim               Claim?        @relation(fields: [claimId], references: [id])

  @@index([escalationDeadline])
  @@index([issueType])
  @@index([status])
}

model User {
  id                       String                    @id
  email                    String?                   @unique
  name                     String?
  role                     UserRole                  @default(ANONYMOUS)
  passwordHash             String?
  emailVerified            Boolean?                  @default(false)
  phoneVerified            Boolean                   @default(false)
  isActive                 Boolean                   @default(true)
  jobTitle                 String?
  phone                    String?
  avatar                   String?
  hotelId                  String?
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime
  lastActive               DateTime?
  twoFactorEnabled         Boolean                   @default(false)
  twoFactorSecret          String?                   // Encrypted TOTP secret
  twoFactorBackupCodes     String[]                  // Hashed backup codes
  twoFactorVerifiedAt      DateTime?                 // When 2FA was enabled
  lastPasswordReset        DateTime?
  passwordResetAttempts    Int                       @default(0)
  passwordResetLastAttempt DateTime?
  resetToken               String?                   @unique
  resetTokenExpiry         DateTime?
  resetTokenUsed           Boolean                   @default(false)
  deletionReason           String?
  deletionRequestedAt      DateTime?
  deletionScheduledFor     DateTime?
  emailVerificationCode    String?
  emailVerificationExpiry  DateTime?
  failedLoginAttempts      Int                       @default(0)
  lastFailedLoginAt        DateTime?
  lockedUntil              DateTime?
  status                   UserStatus                @default(ACTIVE)
  image                    String?
  legacyDualId             String?
  Account                  Account[]
  ActivityLog              ActivityLog[]
  ApiKey                   ApiKey[]
  AuditLog                 AuditLog[]
  DataExportLog            DataExportLog[]
  LoginAttempt             LoginAttempt[]
  NotificationDismissal    NotificationDismissal[]
  paymentMethods           PaymentMethod[]
  rentalBookings           RentalBooking[]
  rentalHost               RentalHost?
  reviewerProfile          ReviewerProfile?
  Session                  Session[]
  Hotel                    Hotel?                    @relation(fields: [hotelId], references: [id])
  UserNotificationSettings UserNotificationSettings?

  @@index([email])
  @@index([hotelId])
  @@index([legacyDualId])
  @@index([resetToken])
  @@index([role])
  @@index([status])
}

model UserNotificationSettings {
  id               String   @id
  userId           String   @unique
  claimFiled       Boolean  @default(true)
  claimApproved    Boolean  @default(true)
  claimDenied      Boolean  @default(true)
  fnolSubmitted    Boolean  @default(true)
  guestHoldNotice  Boolean  @default(true)
  responseReminder Boolean  @default(true)
  claimResolved    Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VehicleClassification {
  id                    String             @id
  make                  String
  model                 String
  year                  Int
  category              VehicleCategory
  riskLevel             RiskCategory
  baseValue             Decimal            @db.Decimal(12, 2)
  currentValue          Decimal            @db.Decimal(12, 2)
  valueSource           String?
  lastValueCheck        DateTime?
  features              Json?
  isInsurable           Boolean            @default(true)
  insurabilityReason    String?
  requiresManualReview  Boolean            @default(false)
  baseRateMultiplier    Decimal            @default(1.0) @db.Decimal(5, 2)
  riskMultiplier        Decimal            @default(1.0) @db.Decimal(5, 2)
  providerId            String?
  providerSpecificRules Json?
  notes                 String?
  createdBy             String?
  updatedBy             String?
  createdAt             DateTime           @default(now())
  updatedAt             DateTime
  RentalCar             RentalCar[]
  InsuranceProvider     InsuranceProvider? @relation(fields: [providerId], references: [id])

  @@unique([make, model, year, providerId])
  @@index([baseValue])
  @@index([category])
  @@index([isInsurable])
  @@index([make, model])
  @@index([providerId])
  @@index([riskLevel])
}

model VehicleCoverageOverride {
  id                String               @id
  carId             String
  vin               String?
  providerId        String
  overrideType      CoverageOverrideType
  customRules       Json
  reason            String
  approvedBy        String
  approvedAt        DateTime             @default(now())
  expiresAt         DateTime?
  isActive          Boolean              @default(true)
  createdAt         DateTime             @default(now())
  updatedAt         DateTime
  car               RentalCar            @relation(fields: [carId], references: [id])
  InsuranceProvider InsuranceProvider    @relation(fields: [providerId], references: [id])

  @@unique([carId, providerId])
  @@index([carId])
  @@index([expiresAt])
  @@index([providerId])
  @@index([vin])
}

model VehicleInsuranceOverride {
  id                String            @id
  carId             String
  providerId        String
  reason            String
  overriddenBy      String
  createdAt         DateTime          @default(now())
  car               RentalCar         @relation(fields: [carId], references: [id])
  InsuranceProvider InsuranceProvider @relation(fields: [providerId], references: [id])

  @@unique([carId, providerId])
  @@index([carId])
  @@index([providerId])
}

model VehicleServiceRecord {
  id                  String      @id
  carId               String
  serviceType         ServiceType
  serviceDate         DateTime
  mileageAtService    Int
  nextServiceDue      DateTime?
  nextServiceMileage  Int?
  shopName            String
  shopAddress         String
  technicianName      String?
  invoiceNumber       String?
  receiptUrl          String
  inspectionReportUrl String?
  itemsServiced       String[]
  costTotal           Float
  notes               String?
  verifiedByFleet     Boolean     @default(false)
  verifiedAt          DateTime?
  verifiedBy          String?
  createdAt           DateTime    @default(now())
  updatedAt           DateTime
  addedBy             String?     @default("SYSTEM")
  addedByType         String?     @default("HOST")
  car                 RentalCar   @relation(fields: [carId], references: [id], onDelete: Cascade)

  @@index([addedByType])
  @@index([addedBy])
  @@index([carId, serviceDate])
  @@index([carId, serviceType])
}

model admin_impersonation_logs {
  id        String    @id
  adminId   String
  partnerId String
  reason    String
  duration  Int?
  ipAddress String?
  userAgent String?
  createdAt DateTime  @default(now())
  endedAt   DateTime?

  @@index([adminId])
  @@index([createdAt])
  @@index([partnerId])
}

model host_charges {
  id                String     @id
  hostId            String
  amount            Float
  chargeType        String
  reason            String
  chargedBy         String
  stripeChargeId    String?
  stripeCustomerId  String?
  status            String
  failureReason     String?
  paymentMethodUsed String?
  metadata          Json?
  notes             String?
  relatedBookingId  String?
  relatedClaimId    String?
  createdAt         DateTime   @default(now())
  processedAt       DateTime?
  refundedAt        DateTime?
  host              RentalHost @relation(fields: [hostId], references: [id], onDelete: Cascade)

  @@index([chargeType])
  @@index([createdAt])
  @@index([hostId])
  @@index([status])
}

model InsuranceHistory {
  id                    String          @id
  reviewerProfileId     String
  action                String
  status                String
  insuranceProvider     String?
  policyNumber          String?
  expiryDate            DateTime?
  hasRideshare          Boolean         @default(false)
  coverageType          String?
  customCoverage        String?
  insuranceCardFrontUrl String?
  insuranceCardBackUrl  String?
  insuranceNotes        String?
  verificationStatus    String          @default("UNVERIFIED")
  verifiedBy            String?
  verifiedAt            DateTime?
  changedBy             String
  changedAt             DateTime        @default(now())
  changeReason          String?
  ipAddress             String?
  userAgent             String?
  createdAt             DateTime        @default(now())
  updatedAt             DateTime
  reviewerProfile       ReviewerProfile @relation(fields: [reviewerProfileId], references: [id], onDelete: Cascade)

  @@index([expiryDate])
  @@index([reviewerProfileId])
  @@index([reviewerProfileId, status])
  @@index([verificationStatus])
  @@map("insurance_history")
}

model ManagementInvitation {
  id                           String                     @id
  token                        String                     @unique
  type                         ManagementInvitationType
  senderId                     String
  recipientId                  String?
  recipientEmail               String
  vehicleIds                   String[]
  proposedOwnerPercent         Decimal                    @default(70) @db.Decimal(5, 2)
  proposedManagerPercent       Decimal                    @default(30) @db.Decimal(5, 2)
  counterOfferOwnerPercent     Decimal?                   @db.Decimal(5, 2)
  counterOfferManagerPercent   Decimal?                   @db.Decimal(5, 2)
  negotiationRounds            Int                        @default(0)
  negotiationNotes             String?
  negotiationHistory           Json?                      @default("[]")
  proposedCanEditListing       Boolean                    @default(true)
  proposedCanAdjustPricing     Boolean                    @default(true)
  proposedCanCommunicateGuests Boolean                    @default(true)
  proposedCanApproveBookings   Boolean                    @default(true)
  proposedCanHandleIssues      Boolean                    @default(true)
  status                       ManagementInvitationStatus @default(PENDING)
  expiresAt                    DateTime
  respondedAt                  DateTime?
  createdAt                    DateTime                   @default(now())
  updatedAt                    DateTime
  recipient                    RentalHost?                @relation("management_invitations_recipientIdToRentalHost", fields: [recipientId], references: [id])
  sender                       RentalHost                 @relation("management_invitations_senderIdToRentalHost", fields: [senderId], references: [id])

  @@index([recipientEmail])
  @@index([recipientId])
  @@index([senderId])
  @@index([status])
  @@index([token])
  @@map("management_invitations")
}

model partner_applications {
  id              String                   @id
  hostId          String                   @unique
  companyName     String
  businessType    String
  yearsInBusiness Int
  contactName     String
  contactEmail    String
  contactPhone    String
  fleetSize       Int
  vehicleTypes    String[]
  operatingCities String[]
  currentStep     Int                      @default(1)
  status          PartnerApplicationStatus @default(DRAFT)
  submittedAt     DateTime?
  reviewedAt      DateTime?
  reviewedBy      String?
  reviewNotes     String?
  createdAt       DateTime                 @default(now())
  updatedAt       DateTime
  host            RentalHost               @relation(fields: [hostId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([submittedAt])
}

model partner_commission_history {
  id        String     @id
  hostId    String
  oldRate   Float
  newRate   Float
  reason    String?
  changedBy String
  createdAt DateTime   @default(now())
  host      RentalHost @relation(fields: [hostId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([hostId])
}

model partner_discounts {
  id          String     @id
  hostId      String
  code        String     @unique
  title       String
  description String?
  percentage  Float
  maxUses     Int?
  usedCount   Int        @default(0)
  startsAt    DateTime?
  expiresAt   DateTime?
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime
  host        RentalHost @relation(fields: [hostId], references: [id], onDelete: Cascade)

  @@index([code])
  @@index([hostId])
  @@index([isActive])
}

model partner_documents {
  id                String                @id
  hostId            String
  type              PartnerDocumentType
  url               String
  uploadedAt        DateTime              @default(now())
  expiresAt         DateTime?
  isExpired         Boolean               @default(false)
  gracePeriodEndsAt DateTime?
  status            PartnerDocumentStatus @default(PENDING)
  reviewedBy        String?
  reviewedAt        DateTime?
  rejectNote        String?
  reminderSentAt    DateTime?
  createdAt         DateTime              @default(now())
  updatedAt         DateTime
  host              RentalHost            @relation(fields: [hostId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([gracePeriodEndsAt])
  @@index([hostId, type])
  @@index([isExpired])
}

model partner_faqs {
  id        String     @id
  hostId    String
  question  String
  answer    String
  order     Int        @default(0)
  createdAt DateTime   @default(now())
  updatedAt DateTime
  host      RentalHost @relation(fields: [hostId], references: [id], onDelete: Cascade)

  @@index([hostId])
}

model partner_payouts {
  id               String              @id
  hostId           String
  period           String
  bookingCount     Int
  grossRevenue     Float
  commission       Float
  netAmount        Float
  stripePayoutId   String?
  stripeTransferId String?
  status           PartnerPayoutStatus @default(PENDING)
  paidAt           DateTime?
  failureReason    String?
  createdAt        DateTime            @default(now())
  host             RentalHost          @relation(fields: [hostId], references: [id], onDelete: Cascade)

  @@index([hostId])
  @@index([period])
  @@index([status])
}

// Fleet Alert Settings - Customizable thresholds for monitoring alerts
model fleet_alert_settings {
  id String @id @default("global")

  // Email Notification Settings
  alertEmailsEnabled   Boolean  @default(true)
  alertEmailRecipients String[] @default([]) // Array of email addresses
  emailDigestEnabled   Boolean  @default(true)
  emailDigestFrequency String   @default("daily") // "instant", "hourly", "daily", "weekly"

  // Partner Alert Thresholds
  partnerPendingDaysWarning Int     @default(3) // Days before app becomes urgent
  suspendedPartnersAlert    Boolean @default(true)

  // Vehicle Alert Thresholds
  pendingVehiclesAlert  Boolean @default(true)
  changesRequestedAlert Boolean @default(true)

  // Booking Alert Thresholds
  highCancellationThreshold  Int     @default(5) // Cancellations in 7 days
  bookingsStartingTodayAlert Boolean @default(true)

  // Document Alert Thresholds
  documentExpiryWarningDays Int     @default(30) // Days before expiry to alert
  documentExpiryUrgentDays  Int     @default(7) // Days before HIGH priority
  expiredDocumentsAlert     Boolean @default(true)
  pendingDocumentsAlert     Boolean @default(true)

  // Financial Alert Thresholds
  negativeBalanceAlert   Boolean @default(true)
  failedPayoutsAlert     Boolean @default(true)
  pendingRefundThreshold Float   @default(250) // Refunds over this amount need approval
  pendingRefundsAlert    Boolean @default(true)

  // Claim Alert Thresholds
  openClaimsAlert Boolean @default(true)

  // Review Alert Thresholds
  lowRatingThreshold Int     @default(2) // Stars threshold for alert
  lowRatingsAlert    Boolean @default(true)

  // Security Alert Thresholds
  securityEventsAlert       Boolean @default(true)
  criticalSecurityThreshold Int     @default(1) // Critical events before alert

  // Performance Thresholds
  slowResponseThreshold     Int @default(1000) // ms before warning
  criticalResponseThreshold Int @default(3000) // ms before critical

  // Notification History
  lastEmailSentAt  DateTime?
  lastDigestSentAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("fleet_alert_settings")
}

// Fleet Alert History - Track sent notifications
model fleet_alert_history {
  id          String   @id @default(cuid())
  type        String // "email", "digest", "push"
  recipients  String[] // Email addresses
  subject     String
  alertCount  Int      @default(0)
  highCount   Int      @default(0)
  mediumCount Int      @default(0)
  lowCount    Int      @default(0)
  categories  String[] // ["partner", "vehicle", "document", etc.]
  sentAt      DateTime @default(now())
  status      String   @default("sent") // "sent", "failed", "bounced"
  error       String?

  @@index([sentAt])
  @@index([type])
  @@map("fleet_alert_history")
}

model PlatformSettings {
  id                       String   @id @default("global")
  defaultTaxRate           Float    @default(0.056)
  taxByState               Json?
  taxByCityOverride        Json?
  platformCommission       Float    @default(0.20)
  partnerMinCommission     Float    @default(0.05)
  partnerMaxCommission     Float    @default(0.50)
  fullRefundHours          Int      @default(72)
  partialRefund75Hours     Int      @default(24)
  partialRefund50Hours     Int      @default(12)
  noRefundHours            Int      @default(12)
  lateReturnGraceMinutes   Int      @default(30)
  pickupGraceMinutes       Int      @default(15)
  mileageOverageRate       Float    @default(0.45)
  dailyIncludedMiles       Int      @default(200)
  fuelRefillRateQuarter    Float    @default(75)
  fuelRefillRateFull       Float    @default(300)
  lateReturnHourlyRate     Float    @default(50)
  lateReturnDailyMax       Float    @default(300)
  cleaningFeeStandard      Float    @default(50)
  cleaningFeeDeep          Float    @default(150)
  cleaningFeeBiohazard     Float    @default(500)
  noShowFee                Float    @default(50)
  smokingFee               Float    @default(250)
  petHairFee               Float    @default(75)
  lostKeyFee               Float    @default(200)
  defaultDepositPercent    Float    @default(0.25)
  minDeposit               Float    @default(200)
  maxDeposit               Float    @default(2500)
  insuranceDiscountPct     Float    @default(0.50)
  standardPayoutDelay      Int      @default(3)
  newHostPayoutDelay       Int      @default(7)
  minimumPayout            Float    @default(50)
  instantPayoutFee         Float    @default(0.015)
  guestSignupBonus         Float    @default(0)
  hostSignupBonus          Float    @default(0)
  referralBonus            Float    @default(0)
  bonusExpirationDays      Int      @default(90)
  minorDamageMax           Float    @default(250)
  moderateDamageMax        Float    @default(500)
  majorDamageMin           Float    @default(1000)
  updatedAt                DateTime
  updatedBy                String?
  basicInsuranceDaily      Float    @default(15)
  exoticDeposit            Float    @default(2500)
  guestReferralBonus       Float    @default(0)
  hostReferralBonus        Float    @default(0)
  insuranceRequiredUnder25 Boolean  @default(true)
  luxuryDeposit            Float    @default(1000)
  premiumInsuranceDaily    Float    @default(25)
  serviceFeeRate           Float    @default(0.15)
  maxBonusPercentage       Float    @default(0.25)
  partnerDirectRefundLimit Float    @default(250)

  @@map("platform_settings")
}

model VehicleManagement {
  id                       String                  @id
  vehicleId                String                  @unique
  ownerId                  String
  managerId                String
  ownerCommissionPercent   Decimal                 @default(70) @db.Decimal(5, 2)
  managerCommissionPercent Decimal                 @default(30) @db.Decimal(5, 2)
  canEditListing           Boolean                 @default(true)
  canAdjustPricing         Boolean                 @default(true)
  canCommunicateGuests     Boolean                 @default(true)
  canApproveBookings       Boolean                 @default(true)
  canHandleIssues          Boolean                 @default(true)
  status                   VehicleManagementStatus @default(ACTIVE)
  agreementNotes           String?
  agreementSignedAt        DateTime?
  createdAt                DateTime                @default(now())
  updatedAt                DateTime
  manager                  RentalHost              @relation("vehicle_management_managerIdToRentalHost", fields: [managerId], references: [id])
  owner                    RentalHost              @relation("vehicle_management_ownerIdToRentalHost", fields: [ownerId], references: [id])
  vehicle                  RentalCar               @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@index([managerId])
  @@index([ownerId])
  @@index([status])
  @@map("vehicle_management")
}

// =============================================================================
// SMARTCAR VEHICLE TRACKING
// For hosts connecting vehicles via Smartcar API (no hardware required)
// =============================================================================

model SmartcarVehicle {
  id                  String    @id @default(cuid())
  hostId              String
  carId               String?   @unique // Optional link to RentalCar if matched
  smartcarVehicleId   String    @unique // Smartcar's vehicle ID
  accessToken         String    @db.Text
  refreshToken        String    @db.Text
  tokenExpiresAt      DateTime
  vin                 String?
  make                String?
  model               String?
  year                Int?
  isActive            Boolean   @default(true)

  // Last synced data
  lastSyncAt          DateTime?
  lastLocation        Json?     // { lat, lng, timestamp }
  lastOdometer        Float?    // miles
  lastFuel            Float?    // percentage (ICE vehicles)
  lastBattery         Float?    // percentage (EVs)
  lastLockStatus      String?   // "locked" | "unlocked"

  // Timestamps
  connectedAt         DateTime  @default(now())
  disconnectedAt      DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  // Relations
  host                RentalHost @relation(fields: [hostId], references: [id], onDelete: Cascade)
  car                 RentalCar? @relation(fields: [carId], references: [id])
  webhooks            SmartcarWebhook[]

  @@index([hostId])
  @@index([carId])
  @@index([vin])
  @@index([isActive])
  @@map("smartcar_vehicles")
}

model SmartcarWebhook {
  id                  String    @id @default(cuid())
  vehicleId           String
  smartcarWebhookId   String    @unique // Smartcar's webhook ID
  webhookType         String    // "scheduled" | "event" | "diagnostic"
  frequency           String?   // "hourly" | "daily" etc. for scheduled
  dataPoints          String[]  // ["location", "odometer", "fuel"]
  isActive            Boolean   @default(true)
  lastReceivedAt      DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  // Relation
  vehicle             SmartcarVehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@index([vehicleId])
  @@index([isActive])
  @@map("smartcar_webhooks")
}

// =============================================================================
// RESERVATION REQUEST SYSTEM
// For handling incoming booking requests and host recruitment
// =============================================================================

// Incoming booking requests from guests (contact form, email, FB, phone)
model ReservationRequest {
  id String @id @default(cuid())

  // Request details
  requestCode String                 @unique @default(cuid())
  requestType ReservationRequestType @default(STANDARD)

  // Guest/requester info
  guestName   String
  guestEmail  String?
  guestPhone  String?
  companyName String? // For corporate requests

  // Vehicle requirements
  vehicleType  String? // "Honda", "Sedan", "SUV", etc.
  vehicleClass String? // "Economy", "Standard", "Luxury"
  vehicleMake  String? // Specific make if requested
  vehicleModel String? // Specific model if requested
  quantity     Int     @default(1)

  // Dates & location
  startDate      DateTime?
  endDate        DateTime?
  durationDays   Int?
  pickupCity     String?
  pickupState    String?
  pickupAddress  String?
  dropoffCity    String?
  dropoffState   String?
  dropoffAddress String?

  // Pricing
  offeredRate  Float? // What guest is willing to pay per day
  totalBudget  Float?
  isNegotiable Boolean @default(true)

  // Status tracking
  status   ReservationRequestStatus @default(OPEN)
  priority RequestPriority          @default(NORMAL)

  // Notes
  guestNotes String? // Original request message
  adminNotes String? // Internal admin notes

  // Metrics
  viewCount     Int @default(0)
  claimAttempts Int @default(0)

  // Source tracking
  source        String? // "contact_form", "email", "phone", "facebook"
  sourceDetails String? // FB listing URL, email subject, etc.

  // Fulfilled booking reference
  fulfilledBookingId String?        @unique
  fulfilledBooking   RentalBooking? @relation(fields: [fulfilledBookingId], references: [id])

  // Admin who created this request
  createdBy String?

  // Expiration
  expiresAt DateTime?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  claims           RequestClaim[]
  invitedProspects HostProspect[]

  @@index([status])
  @@index([pickupCity, pickupState])
  @@index([vehicleType])
  @@index([startDate])
  @@index([createdAt])
  @@index([expiresAt])
  @@map("reservation_requests")
}

// Host prospects found on Facebook Marketplace or other sources (pre-account)
model HostProspect {
  id String @id @default(cuid())

  // Contact info from conversation
  name  String
  email String
  phone String?

  // Vehicle info they mentioned
  vehicleMake        String?
  vehicleModel       String?
  vehicleYear        Int?
  vehicleDescription String? // "2 cars", "Honda fleet", etc.

  // Source tracking
  source            ProspectSource @default(FACEBOOK_MARKETPLACE)
  sourceUrl         String? // FB profile or listing URL
  conversationNotes String? // Notes from conversation

  // Invite tracking
  inviteToken       String?   @unique
  inviteTokenExp    DateTime?
  inviteSentAt      DateTime?
  inviteEmailId     String? // For tracking via email provider
  inviteResendCount Int       @default(0)
  lastResendAt      DateTime?

  // Funnel tracking
  status         ProspectStatus @default(DRAFT)
  emailOpenedAt  DateTime?
  emailOpenCount Int            @default(0)
  linkClickedAt  DateTime?
  linkClickCount Int            @default(0) // How many times clicked
  pageViewedAt   DateTime?
  pageViewCount  Int            @default(0)
  lastActivityAt DateTime?
  convertedAt    DateTime?

  // Extended tracking - "Spy" system
  dashboardViewedAt   DateTime? // When they first viewed dashboard
  requestPageViewedAt DateTime? // When they viewed request details page
  pageViewDuration    Int? // Seconds spent on page (updated periodically)

  // Expired link access tracking
  expiredAccessCount  Int       @default(0) // How many times tried with expired link
  lastExpiredAccessAt DateTime? // Last time they tried with expired link

  // Counter-offer system
  counterOfferAmount     Float? // Host's proposed rate (if different)
  counterOfferNote       String? // Host's explanation
  counterOfferAt         DateTime? // When submitted
  counterOfferStatus     CounterOfferStatus? // PENDING, APPROVED, REJECTED, EXPIRED
  counterOfferReviewedBy String? // Admin who reviewed
  counterOfferReviewedAt DateTime? // When reviewed

  // Onboarding progress (tracks what host has completed)
  onboardingStartedAt   DateTime? // When they clicked "Start"
  carPhotosUploaded     Boolean   @default(false)
  ratesConfigured       Boolean   @default(false)
  payoutConnected       Boolean   @default(false)
  agreementUploaded     Boolean   @default(false)
  onboardingCompletedAt DateTime? // When all steps done

  // Host agreement
  hostAgreementUrl           String? // Their existing rental agreement PDF
  hostAgreementName          String? // Original filename
  agreementValidationScore   Int? // AI validation score 0-100
  agreementValidationSummary String? // AI summary of the agreement
  itwhipAgreementAccepted    Boolean @default(false)

  // Test E-Sign (for host to preview the signing experience)
  testAgreementToken     String?   @unique // Token for test signing
  testAgreementExpiresAt DateTime? // 1 day expiry
  testAgreementSentAt    DateTime? // When test email was sent
  testAgreementSignedAt  DateTime? // When host signed the test

  // Link to specific request they were invited for
  requestId String?
  request   ReservationRequest? @relation(fields: [requestId], references: [id])

  // Link to created host account (after conversion)
  convertedHostId String?     @unique
  convertedHost   RentalHost? @relation("prospect_to_host", fields: [convertedHostId], references: [id])

  // Converted booking (the booking created from this request)
  convertedBookingId String?        @unique
  convertedBooking   RentalBooking? @relation("prospect_to_booking", fields: [convertedBookingId], references: [id])

  // Activity log
  activities ProspectActivity[]

  // Admin tracking
  addedBy String? // Admin who added this prospect

  // Timestamps
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  archivedAt DateTime?

  @@index([email])
  @@index([status])
  @@index([inviteToken])
  @@index([requestId])
  @@index([convertedHostId])
  @@index([convertedBookingId])
  @@index([source])
  @@index([counterOfferStatus])
  @@index([onboardingCompletedAt])
  @@map("host_prospects")
}

// Guest prospect for recruitment/invitation system
model GuestProspect {
  id String @id @default(cuid())

  // 
  // BASIC INFO
  // 
  name   String
  email  String
  phone  String?
  notes  String? // Admin notes
  source String? @default("admin_invite") // Where did we find them

  // 
  // CREDIT INCENTIVE
  // 
  creditAmount         Float   @default(0) // Amount offered (e.g., $250)
  creditType           String  @default("credit") // 'credit' | 'bonus' | 'deposit'
  creditPurpose        String  @default("guest_invite") // 'guest_invite' | 'booking_credit' | 'refund_credit'
  creditNote           String? // Why this credit (e.g., "Referral bonus")
  creditExpirationDays Int? // Optional expiration (days from activation)
  referenceBooking     Json? // For booking_credit: { vehicle, referenceId, pickupDate, returnDate, location }

  // 
  // INVITE TOKEN (72-hour expiry)
  // 
  inviteToken       String?   @unique
  inviteTokenExp    DateTime?
  inviteSentAt      DateTime?
  inviteResendCount Int       @default(0)
  lastResendAt      DateTime?

  // 
  // TRACKING (Spy System)
  // 
  emailOpenedAt  DateTime?
  emailOpenCount Int       @default(0)
  linkClickedAt  DateTime?
  linkClickCount Int       @default(0)
  lastActivityAt DateTime?

  // 
  // EXPIRED LINK TRACKING
  // 
  expiredAccessCount  Int       @default(0)
  lastExpiredAccessAt DateTime?

  // 
  // CONVERSION
  // 
  status             GuestProspectStatus @default(DRAFT)
  convertedAt        DateTime?
  convertedProfileId String?             @unique // The ReviewerProfile created
  convertedProfile   ReviewerProfile?    @relation(fields: [convertedProfileId], references: [id])
  creditAppliedAt    DateTime? // When credit was added to their account

  // 
  // ACTIVITY LOG
  // 
  activities GuestProspectActivity[]

  // 
  // METADATA
  // 
  createdBy  String? // Admin who created
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  archivedAt DateTime?

  @@index([email])
  @@index([status])
  @@index([inviteToken])
  @@index([convertedProfileId])
  @@map("guest_prospects")
}

// Activity log for guest prospect tracking
model GuestProspectActivity {
  id         String        @id @default(cuid())
  prospectId String
  prospect   GuestProspect @relation(fields: [prospectId], references: [id], onDelete: Cascade)

  // Activity type
  activityType String // EMAIL_SENT, EMAIL_OPENED, LINK_CLICKED, CONVERTED,
  // CREDIT_APPLIED, EXPIRED_ACCESS

  // Additional metadata (IP, user agent, etc.)
  metadata Json?

  // Timestamp
  createdAt DateTime @default(now())

  @@index([prospectId])
  @@index([activityType])
  @@index([createdAt])
  @@map("guest_prospect_activities")
}

enum GuestProspectStatus {
  DRAFT // Created but not sent
  INVITED // Email sent
  CLICKED // Clicked link
  CONVERTED // Account created
  EXPIRED // Token expired without conversion
}

// When a host claims a reservation request
model RequestClaim {
  id String @id @default(cuid())

  // What was claimed
  requestId String
  request   ReservationRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)

  // Who claimed it
  hostId String
  host   RentalHost @relation(fields: [hostId], references: [id])

  // Vehicle assignment (after host adds/selects car)
  carId String?
  car   RentalCar? @relation(fields: [carId], references: [id])

  // Claim status with stages
  status RequestClaimStatus @default(PENDING_CAR)

  // 30-minute countdown
  claimExpiresAt DateTime // When the claim times out if no car added

  // Host's offer (can differ from guest's requested rate)
  offeredRate Float?
  hostNotes   String?

  // Result tracking
  bookingId String?        @unique
  booking   RentalBooking? @relation(fields: [bookingId], references: [id])

  // Timestamps
  claimedAt     DateTime  @default(now())
  carAssignedAt DateTime?
  completedAt   DateTime?
  expiredAt     DateTime?
  withdrawnAt   DateTime?

  @@unique([requestId, hostId]) // One claim per host per request
  @@index([requestId])
  @@index([hostId])
  @@index([status])
  @@index([claimExpiresAt])
  @@map("request_claims")
}

// Activity log for prospect/recruited host tracking
model ProspectActivity {
  id         String       @id @default(cuid())
  prospectId String
  prospect   HostProspect @relation(fields: [prospectId], references: [id], onDelete: Cascade)

  // Activity type
  activityType String // EMAIL_OPENED, LINK_CLICKED, PAGE_VIEWED, COUNTER_OFFER,
  // STARTED_ONBOARDING, PHOTO_UPLOADED, RATE_SET,
  // PAYOUT_CONNECTED, COMPLETED, DECLINED

  // Additional metadata (IP, user agent, duration, etc.)
  metadata Json?

  // Timestamp
  createdAt DateTime @default(now())

  @@index([prospectId])
  @@index([activityType])
  @@index([createdAt])
  @@map("prospect_activities")
}

// Email tracking and audit log
model EmailLog {
  id          String   @id @default(cuid())
  referenceId String   @unique // REF-IW-XXXXXX for support lookup

  // Email details
  recipientEmail String
  recipientName  String?
  subject        String
  emailType      EmailType

  // Link to related records (polymorphic)
  relatedType String? // "guest_prospect", "host_prospect", "booking", "user"
  relatedId   String? // ID of the related record

  // Verification tracking
  verificationToken String?  @unique // For magic link verification
  verificationExp   DateTime? // When verification link expires
  verifiedAt        DateTime? // When user verified email

  // Delivery tracking
  status      EmailStatus @default(QUEUED)
  sentAt      DateTime?
  deliveredAt DateTime?
  openedAt    DateTime?
  clickedAt   DateTime?
  bouncedAt   DateTime?
  bounceReason String?

  // Metadata
  messageId   String? // SMTP message ID
  metadata    Json?   // Additional context (IP, user agent, etc.)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([recipientEmail])
  @@index([emailType])
  @@index([status])
  @@index([relatedType, relatedId])
  @@index([verificationToken])
  @@index([createdAt])
  @@map("email_logs")
}

enum EmailType {
  GUEST_INVITE
  HOST_INVITE
  PASSWORD_RESET
  EMAIL_VERIFICATION
  BOOKING_CONFIRMATION
  BOOKING_REMINDER
  PAYMENT_RECEIPT
  REFUND_NOTIFICATION
  IDENTITY_VERIFICATION
  WELCOME
  NEWSLETTER
  SUPPORT
  SYSTEM
}

enum EmailStatus {
  QUEUED
  SENT
  DELIVERED
  OPENED
  CLICKED
  BOUNCED
  FAILED
}

// Enums for the reservation request system
enum ReservationRequestType {
  STANDARD // Regular guest request
  CORPORATE // Company/business request
  BULK // Multiple vehicles needed
  EVENT // Special event (wedding, filming, etc.)
  LONG_TERM // 30+ day rental
}

enum ReservationRequestStatus {
  OPEN // Available for hosts to claim
  CLAIMED // A host has claimed, waiting for car assignment
  CAR_ASSIGNED // Host assigned a car, pending booking creation
  FULFILLED // Booking created successfully
  EXPIRED // No one claimed in time
  CANCELLED // Admin cancelled the request
}

enum RequestPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum ProspectSource {
  FACEBOOK_MARKETPLACE
  CRAIGSLIST
  TURO
  GETAROUND
  REFERRAL
  DIRECT_CONTACT
  WEBSITE_CONTACT
  PHONE
  EMAIL
  OTHER
}

enum ProspectStatus {
  DRAFT // Saved but email not sent
  EMAIL_SENT // Invite email sent
  EMAIL_OPENED // Email was opened (via tracking)
  LINK_CLICKED // Clicked the invite link
  CONVERTED // Created account / logged in
  CLAIMED_REQUEST // Claimed a request
  FULFILLED // Successfully completed a booking
  ARCHIVED // No longer pursuing
  BOUNCED // Email bounced
  UNSUBSCRIBED // Opted out
}

enum CounterOfferStatus {
  PENDING // Awaiting admin review
  APPROVED // Admin approved the counter-offer
  REJECTED // Admin rejected the counter-offer
  EXPIRED // Timed out without review
}

enum RequestClaimStatus {
  PENDING_CAR // Claimed, waiting for host to add/select car
  CAR_SELECTED // Car assigned, waiting for booking creation
  COMPLETED // Booking created successfully
  EXPIRED // Didn't add car in time, claim released
  WITHDRAWN // Host cancelled their claim
  REJECTED // Admin rejected the claim
}

enum AppealStatus {
  PENDING
  UNDER_REVIEW
  APPROVED
  DENIED
  WITHDRAWN
}

enum ApplicationStatus {
  NEW
  REVIEWING
  PHONE_SCREEN
  TECHNICAL_TEST
  INTERVIEW_SCHEDULED
  INTERVIEWED
  REFERENCE_CHECK
  OFFER_EXTENDED
  OFFER_ACCEPTED
  REJECTED
  WITHDRAWN
  HIRED
}

enum AttackType {
  BRUTE_FORCE
  DICTIONARY
  SQL_INJECTION
  XSS
  CSRF
  DDOS
  MAN_IN_MIDDLE
  SESSION_HIJACK
  CREDENTIAL_STUFFING
  BOT
}

enum AuditCategory {
  AUTHENTICATION
  AUTHORIZATION
  DATA_ACCESS
  DATA_MODIFICATION
  CONFIGURATION
  SECURITY
  COMPLIANCE
  FINANCIAL
  CHARGE_MANAGEMENT
  HOST_MANAGEMENT
}

enum AuditSeverity {
  INFO
  WARNING
  ERROR
  CRITICAL
}

enum BackgroundCheckStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  PASSED
  FAILED
  EXPIRED
  ERROR
}

enum BookingSource {
  DIRECT
  EXPEDIA
  BOOKING_COM
  AIRBNB
  AMADEUS
  SABRE
  WEBSITE
  PHONE
  WALK_IN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CHECKED_IN
  CHECKED_OUT
  CANCELLED
  NO_SHOW
}

enum CancelledBy {
  GUEST
  ADMIN
  HOST
  SYSTEM
}

enum CertificationTier {
  NONE
  TU_3_C
  TU_2_B
  TU_1_A
}

enum ChargeStatus {
  PENDING
  PROCESSING
  CHARGED
  FAILED
  WAIVED
  DISPUTED
  ADJUSTED
  REFUNDED
  PARTIALLY_WAIVED
  PARTIAL_CHARGED
  ADJUSTED_CHARGED
  FULLY_WAIVED
  ADJUSTED_PENDING
  ADJUSTMENT_FAILED
  UNDER_REVIEW
  EXPIRED
}

enum ClaimStatus {
  PENDING
  UNDER_REVIEW
  APPROVED
  DENIED
  PAID
  DISPUTED
  RESOLVED
  GUEST_RESPONSE_PENDING
  GUEST_NO_RESPONSE
  VEHICLE_REPAIR_PENDING
  INSURANCE_PROCESSING
  CLOSED
  GUEST_RESPONDED
}

enum ClaimType {
  ACCIDENT
  THEFT
  VANDALISM
  CLEANING
  MECHANICAL
  WEATHER
  OTHER
}

enum CoverageOverrideType {
  FULL_APPROVAL
  PARTIAL_APPROVAL
  CUSTOM_PRICING
  TIER_RESTRICTION
  TEMPORARY_APPROVAL
  MANUAL_REVIEW
}

enum DisputeStatus {
  OPEN
  UNDER_REVIEW
  INVESTIGATING
  RESOLVED
  CLOSED
}

enum DisputeType {
  DAMAGE
  REFUND
  SERVICE
  MILEAGE
  FUEL
  LATE_RETURN
  CLEANING
  OTHER
}

enum DocumentReviewStatus {
  PENDING
  REVIEWING
  APPROVED
  REJECTED
  NEEDS_CLARIFICATION
}

enum DocumentStatus {
  NOT_UPLOADED
  UPLOADED
  UNDER_REVIEW
  APPROVED
  REJECTED
  EXPIRED
  RESUBMISSION_REQUIRED
}

enum EarningsTier {
  BASIC
  STANDARD
  PREMIUM
}

enum FraudSeverity {
  INFO
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum GovernmentIdType {
  PASSPORT
  STATE_ID
  NATIONAL_ID
  DRIVERS_LICENSE
}

enum HostInsuranceStatus {
  ACTIVE
  EXPIRED
  DEACTIVATED
  SUSPENDED
  PENDING
  INACTIVE
}

enum HotelSize {
  SMALL
  MEDIUM
  LARGE
  ENTERPRISE
}

enum InsuranceProviderType {
  EMBEDDED
  TRADITIONAL
}

enum InsuranceStatus {
  NONE
  PENDING
  ACTIVE
  DEACTIVATED
  EXPIRED
  SUSPENDED
  INACTIVE
}

enum InsuranceTier {
  MINIMUM
  BASIC
  PREMIUM
  LUXURY
}

enum JobType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERNSHIP
  TEMPORARY
}

enum ManagementInvitationStatus {
  PENDING
  COUNTER_OFFERED
  ACCEPTED
  DECLINED
  EXPIRED
  CANCELLED
}

enum ManagementInvitationType {
  OWNER_INVITES_MANAGER
  MANAGER_INVITES_OWNER
}

enum MemberTier {
  BRONZE
  SILVER
  GOLD
  PLATINUM
  DIAMOND
}

enum MergeStatus {
  PENDING
  VERIFIED
  COMPLETED
  REJECTED
  EXPIRED
  GUEST_CONFIRMED
}

enum MessageStatus {
  UNREAD
  READ
  REPLIED
  ARCHIVED
}

enum MetricPeriod {
  DAY
  WEEK
  MONTH
  YEAR
}

enum ModerationType {
  WARNING
  SUSPEND
  UNSUSPEND
  BAN
  UNBAN
  RESTRICTION_ADDED
  RESTRICTION_REMOVED
  NOTE_ADDED
}

enum NotificationStatus {
  PENDING
  SENT
  DELIVERED
  READ
  RESPONDED
  FAILED
  EXPIRED
}

enum PartnerApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
}

enum PartnerDocumentStatus {
  PENDING
  VERIFIED
  REJECTED
  EXPIRED
}

enum PartnerDocumentType {
  BUSINESS_LICENSE
  INSURANCE_CERTIFICATE
  COMMERCIAL_AUTO_POLICY
  BACKGROUND_CHECK
  W9_FORM
  ARTICLES_OF_INCORPORATION
}

enum PartnerPayoutSchedule {
  DAILY
  WEEKLY
  BIWEEKLY
  MONTHLY
}

enum PartnerPayoutStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum PaymentStatus {
  PENDING
  AUTHORIZED
  CAPTURED
  PAID
  FAILED
  REFUNDED
  PENDING_CHARGES
  CHARGES_PAID
  CHARGES_WAIVED
  PARTIAL_REFUND
  PARTIAL_PAID
  ADJUSTED_PAID
}

enum PayoutStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum PolicyStatus {
  ACTIVE
  EXPIRED
  CANCELLED
  CLAIMED
}

enum PropertyType {
  HOTEL
  RESORT
  MOTEL
  BNB
  BOUTIQUE
  CHAIN
  INDEPENDENT
}

enum RecoveryStatus {
  PENDING
  PARTIAL
  FULL
  FAILED
  WAIVED
}

enum RefundRequestStatus {
  PENDING
  APPROVED
  REJECTED
  PROCESSED
  CANCELLED
}

enum RentalBookingStatus {
  PENDING
  CONFIRMED
  ACTIVE
  COMPLETED
  CANCELLED
  NO_SHOW
  DISPUTE_REVIEW
}

enum RevenuePeriod {
  DAY
  WEEK
  MONTH
  TOTAL
}

enum RevenueStatus {
  PENDING
  AVAILABLE
  PROCESSING
  WITHDRAWN
  HELD
}

enum ReviewSource {
  GUEST
  SEED
  MANAGED
  ADMIN
}

enum RideStatus {
  REQUESTED
  SEARCHING
  DRIVER_ASSIGNED
  DRIVER_ARRIVED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  GHOST
}

enum RiskCategory {
  LOW
  MEDIUM
  HIGH
  EXTREME
}

enum ServiceType {
  OIL_CHANGE
  STATE_INSPECTION
  TIRE_ROTATION
  BRAKE_CHECK
  FLUID_CHECK
  BATTERY_CHECK
  AIR_FILTER
  MAJOR_SERVICE_30K
  MAJOR_SERVICE_60K
  MAJOR_SERVICE_90K
  CUSTOM
}

enum SuspensionLevel {
  SOFT
  HARD
  BANNED
}

enum ThreatSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum ThreatStatus {
  DETECTED
  INVESTIGATING
  MITIGATED
  BLOCKED
  RESOLVED
  FALSE_POSITIVE
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
}

enum TransactionType {
  RIDE_COMMISSION
  BOOKING
  WITHDRAWAL
  FEE
  REFUND
}

enum TripStatus {
  NOT_STARTED
  ACTIVE
  COMPLETED
  ENDED_PENDING_REVIEW
}

enum UserRole {
  ANONYMOUS
  CLAIMED
  STARTER
  BUSINESS
  ENTERPRISE
  ADMIN
}

enum UserStatus {
  ACTIVE
  PENDING_DELETION
  DELETED
  SUSPENDED
}

enum VehicleCategory {
  ECONOMY
  STANDARD
  PREMIUM
  LUXURY
  EXOTIC
  SUPERCAR
}

enum VehicleManagementStatus {
  PENDING
  ACTIVE
  PAUSED
  TERMINATED
}

enum VehicleType {
  RENTAL
  RIDESHARE
}

enum VerificationStatus {
  PENDING
  SUBMITTED
  APPROVED
  REJECTED
  PENDING_CHARGES
  DISPUTE_REVIEW
  COMPLETED
}

enum WarningCategory {
  LATE_RETURNS
  VEHICLE_DAMAGE
  CLEANLINESS_ISSUES
  MILEAGE_VIOLATIONS
  POLICY_VIOLATIONS
  FRAUDULENT_ACTIVITY
  PAYMENT_ISSUES
  COMMUNICATION_ISSUES
  INAPPROPRIATE_BEHAVIOR
  UNAUTHORIZED_DRIVER
  SMOKING_VIOLATION
  PET_VIOLATION
  FUEL_VIOLATIONS
  DOCUMENTATION_ISSUES
  OTHER
}
